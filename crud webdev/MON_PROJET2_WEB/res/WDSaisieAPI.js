/*! 26.0.5.0 */
/*! VersionVI: 01F260056u   */
function WDSaisieAPI(n,t,i){if(arguments.length){WDSaisieAPI.gclSingleton=this;this.m_bModeWeb=!!n;this.m_oIFrame=t;this.m_oWindowPrincipale=window;this.m_oWindow=t.contentWindow||window;this.m_oDocument=this.m_oWindow.document;this.m_oOptions=i||{};this.m_oElementCourant=undefined;this.m_nNombreDesactivationsEcoute=0;for(sMethode in WDSaisieAPI.prototype)WDSaisieAPI[sMethode]=WDSaisieAPI.prototype[sMethode].bind(WDSaisieAPI.gclSingleton);this.m_oIFrame.contentWindow||this.SetProp_Valeur(this.m_oIFrame.innerHTML)}}WDSaisieAPI.PLANCHE_NB_IMAGES=52;WDSaisieAPI.ms_sCodeInitial="<!DOCTYPE html>\n<html>\n\t<head>\n\t<\/head>\n\t<body>\n\t\t<p><\/p>\n\t<\/body>\n<\/html>";WDSaisieAPI.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})};WDSaisieAPI.prototype.TestOK=function(){return 1};WDSaisieAPI.prototype.Set_designMode=function(n){var t=n==="on"||n==="ON"||n===!0;this.m_oDocument.designMode=t?"on":"off";t&&this.m_oDocument.execCommand("styleWithCSS",!1,!this.m_oOptions.bEnModeMail)};WDSaisieAPI.prototype.execCommand=function(n){this.m_oDocument.execCommand(n)};WDSaisieAPI.prototype._surInput=function(n){var t=this.__oGetSelection(),f,h,o,r,c,i;if(t&&t.focusNode&&t.focusNode.nodeType===Node.TEXT_NODE){if(this.m_sDerniereValeurHtmlAffectee=undefined,n.inputType==="deleteContentBackward"&&(f=$(t.focusNode.parentElement),f.length&&(f.attr("href")||"").length)){i=this.m_oDocument.createRange();i.selectNode(f.get(0));t.removeAllRanges();t.addRange(i);this.CMD_SupprimeLien();t.collapse(t.focusNode,t.focusNode.textContent.length);return}if(n.inputType==="insertParagraph"||n.data===" "){var u=t.focusNode,e=t.anchorOffset-1,s=1;(n.inputType==="insertParagraph"&&(u=t.focusNode.parentElement.previousElementSibling.lastChild,e=u.length,s=0),h=u.textContent.substr(0,e),h)&&(o=h.split(/(\s|\n)/g),o.length)&&(r=o[o.length-1],r)&&(c=!1,(r.indexOf("://")!==-1||(c=r.indexOf("www.")===0))&&(i=this.m_oDocument.createRange(),i.setStart(u,e-r.length),i.setEnd(u,e),t.removeAllRanges(),t.addRange(i),c&&(r="//"+r),this.CMD_ChangeLien(r),i=this.m_oDocument.createRange(),i.setStart(t.focusNode.parentElement.nextSibling||t.focusNode.parentElement.parentElement.nextSibling,s),i.setEnd(t.focusNode.parentElement.nextSibling||t.focusNode.parentElement.parentElement.nextSibling,s),t.removeAllRanges(),t.addRange(i)))}}};WDSaisieAPI.prototype.bSelectionACorriger=function(){var n=this.__oGetSelection(),t,i;return n?n.type=="None"?!0:n.type=="Range"?!1:(t=this.oGetRange(),!t)?!0:t.startOffset!=0?!1:(i=this.GetProp_Selection(),i.debut!=0)?!1:!0:!0};WDSaisieAPI.prototype.CorrigeSelectionSurSetFocus=function(){this.bSelectionACorriger()&&this.CMD_Selectionne(0,0)};WDSaisieAPI.prototype.ForceSelectionDansDoc=function(){if(this.m_oIFrame.contentWindow){var n=this.m_oWindowPrincipale.getSelection();n.containsNode(this.m_oIFrame)&&(this._DesactiveEcoute_SelectionChanged(),n.removeAllRanges(),this.m_oIFrame.focus(),this._ActiveEcoute_SelectionChanged())}};WDSaisieAPI.prototype._onSelectionChanged=function(){if(window.WL&&!this.m_bInSelectionChanged){this.m_bInSelectionChanged=!0;var t=this.__oGetSelection(),i={};for(var n in t)typeof t[n]!="function"&&(i[n]=t[n]);for(n in i)if(!this.m_oSelectionPrecedente||this.m_oSelectionPrecedente[n]===undefined||t[n]!=this.m_oSelectionPrecedente[n]){this.m_oSelectionPrecedente=$.extend({},i);this.m_nTimerSELECTIONCHANGE&&clearTimeout(this.m_nTimerSELECTIONCHANGE);this.m_nTimerSELECTIONCHANGE=setTimeout(()=>WL.Execute(this.sGetWLEXEC("WLEXEC_SELECTIONCHANGE"),""),300);break}this.m_oSelectionPrecedente=i;this.m_bInSelectionChanged=!1}};WDSaisieAPI.prototype._ActiveEcoute_SelectionChanged=function(){(--this.m_nNombreDesactivationsEcoute,this._AutoriseEcoute_SelectionChanged())&&(this.m_oObserver&&this.m_oObserver.observe(this.m_oDocument,{attributes:!1,childList:!0,subtree:!0,characterData:!0}),this.m_oDocument.body.addEventListener("input",this._surInput.bind(this)),this.m_oDocument.addEventListener("selectionchange",this._onSelectionChanged.bind(this)))};WDSaisieAPI.prototype._DesactiveEcoute_SelectionChanged=function(){++this.m_nNombreDesactivationsEcoute;this.m_oObserver&&this.m_oObserver.disconnect();this.m_oDocument.body.removeEventListener("input",this._surInput.bind(this));this.m_oDocument.removeEventListener("selectionchange",this._onSelectionChanged.bind(this))};WDSaisieAPI.prototype._AutoriseEcoute_SelectionChanged=function(){return this.m_nNombreDesactivationsEcoute===0};WDSaisieAPI.prototype.GetDocument=function(){return this.m_oDocument};WDSaisieAPI.prototype.ExecuteJSDansContexte=function(n){return this.m_oWindow.eval(n)};WDSaisieAPI.prototype.SetProp_Valeur=function(n,t){var i,u;if(this._DesactiveEcoute_SelectionChanged(),this.m_oIFrame.contentWindow?(this.m_oDocument.open(),this.m_oDocument.write(n||WDSaisieAPI.ms_sCodeInitial),this.m_oDocument.close(),this.m_sDerniereValeurHtmlAffectee=n,this.m_oDocument||(this.m_oDocument.open(),this.m_oDocument.write(WDSaisieAPI.ms_sCodeInitial),this.m_oDocument.close(),this.m_sDerniereValeurHtmlAffectee=undefined)):this.m_oIFrame.innerHTML=n||WDSaisieAPI.ms_sCodeInitial,Array.prototype.forEach.call(document.getElementsByTagName("meta"),function(n){n.getAttribute("charset")&&n.setAttribute("charset","utf-8");(n.getAttribute("http-equiv")||"").toLowerCase()=="content-type"&&n.setAttribute("content",n.getAttribute("content").split(";").filter(n=>n.toLowerCase().indexOf("charset")==-1).join(";"))}),this.m_bModeWeb&&this.Set_designMode(!0),this.m_tabBaliseCssAjoutee=undefined,!t&&this.m_oOptions&&this.m_oOptions.domStyleCommun){i=clWDUtil.isArray(this.m_oOptions.domStyleCommun)?this.m_oOptions.domStyleCommun:[this.m_oOptions.domStyleCommun];u=this.m_oDocument.createElement("style");u.innerHTML="::selection { color:inherit; background:rgba(0,0,0,0.22); }";i.push(u);var r=this.m_oWindow.getComputedStyle(this.m_oDocument.body),f=clWDUtil.tabHTML2RVBA(r.color),o=clWDUtil.tabHTML2RVBA(r.backgroundColor),s="rgba("+f[0]+", "+f[1]+", "+f[2]+", 0.15)",e=this.m_oDocument.createElement("style");e.innerHTML=".wbSaisieRicheBarre{ background-color:"+(o[3]===0?"white":r.backgroundColor)+";border-color:"+r.borderColor+";}.wbBarreOutilsMiniBarreLi:hover{background-color:"+s+";}";i.push(e);this.m_tabBaliseCssAjoutee=i.concat(clWDUtil.isArray(this.m_oOptions.domStyleCommun)?this.m_oOptions.domStyleCommun:[this.m_oOptions.domStyleCommun]);this._RemetStyleInterne(!0)}this.m_bModeWeb||(window.document.onselectionchange=()=>{this.ForceSelectionDansDoc()});this.__InitGestionJS();this.CMD_Selectionne(0,0);window.WL&&(this.m_oObserver=new MutationObserver(n=>{var e=!1,i,u,o,t,f,r;for(iMutation in n)if(n[iMutation]&&n[iMutation].type==="childList"){for(i=0;i<(n[iMutation].addedNodes||[]).length;++i)if(n[iMutation].addedNodes[i]&&n[iMutation].addedNodes[i].nodeType===Node.ELEMENT_NODE){u=!1;o=n[iMutation].addedNodes[i].tagName.toLowerCase();switch(o){case"table":case"td":case"tr":case"th":case"p":case"div":case"ul":case"ol":case"li":case"dl":case"dt":case"dd":u=!0}u&&(t=n[iMutation].addedNodes[i],f="\n",t.parentElement&&t.parentElement.previousSibling&&t.parentElement.previousSibling.nodeType==Node.TEXT_NODE&&t.parentElement.previousSibling.textContent.replace(/[\r\n\t\s]/g,"").length===0&&(f=t.parentElement.previousSibling.textContent+"\t"),t.parentElement&&t.parentElement.insertBefore&&(this._DesactiveEcoute_SelectionChanged(),t.parentElement.insertBefore(this.m_oDocument.createTextNode(f),t),this._ActiveEcoute_SelectionChanged()))}if(r=n[iMutation].addedNodes||n[iMutation].removedNodes,r)for(iNode in r)if(r[iNode]&&r[iNode].outerHTML&&(!r[iNode].parentElement||r[iNode].outerHTML.indexOf("sizzle")>-1)){e=!0;break}}e||(this.m_sDerniereValeurHtmlAffectee=undefined,WL.Execute("htmlchange",""))}));this._ActiveEcoute_SelectionChanged();window.WL&&WL.Execute(this.sGetWLEXEC("WLEXEC_ONLOAD"),"")};WDSaisieAPI.prototype.SetDocumentDefaut=function(n,t,i){if(this.SetProp_Valeur("<html><body style='font-family: Arial,Helvetica,sans-serif;'>\n<\/body><\/html>"),this.m_oDocument.documentElement.style.color=n,this.m_oDocument.documentElement.style.backgroundColor=t,i&&!n&&!t){var r=this.m_oDocument.createElement("style");r.innerHTML=" @media(prefers-color-scheme: dark) { html  { background: black; color: white; } } @media(prefers-color-scheme: light) { html  { color: black; background: white; } }";this.m_oDocument.head.insertBefore(r,this.m_oDocument.head.firstElementChild)}};WDSaisieAPI.prototype.InitSelection=function(){this.m_oIFrame.focus();this.CMD_Selectionne(0,0)};WDSaisieAPI.prototype._RetireStyleInterne=function(){if(this._DesactiveEcoute_SelectionChanged(),this.m_tabBaliseCssAjoutee&&clWDUtil.bForEach(this.m_tabBaliseCssAjoutee,function(n){return n.remove(),!0}),window.$){var n=this.m_oDocument,t=$(n.body);t.trigger("trigger.wb.saisieriche.deselectionneTout")}this._ActiveEcoute_SelectionChanged()};WDSaisieAPI.prototype._RemetStyleInterne=function(n){var i,t;if(this.m_tabBaliseCssAjoutee&&this.m_tabBaliseCssAjoutee.length){for(this._DesactiveEcoute_SelectionChanged(),i=this.m_tabBaliseCssAjoutee.length-1;i>=0;--i)t=this.m_tabBaliseCssAjoutee[i],n&&(t.href?t.href+="?"+Math.random(1,999):t.innerHTML+=".truc"+(Math.random(1,999)+"").replace(/\./g,"")+"{ will-change:opacity; }"),this.m_oDocument.head.insertBefore(t,this.m_oDocument.head.firstElementChild);this._ActiveEcoute_SelectionChanged()}};WDSaisieAPI.prototype.GetProp_Valeur=function(){var n,t,i;return this.m_sDerniereValeurHtmlAffectee?this.m_sDerniereValeurHtmlAffectee:(this._DesactiveEcoute_SelectionChanged(),this._RetireStyleInterne(),sSauveAttrClass=function(n){var t=$(n),i=t.attr("class")||"";return t.attr("class",i.split(" ").filter(function(n){return n.indexOf("wbSaisieRiche")===-1}).join(" ")).attr("class")==""&&t.removeAttr("class"),i},n=sSauveAttrClass(this.m_oDocument.body),t=sSauveAttrClass(this.m_oDocument.documentElement),$(this.m_oDocument.getElementsByTagName("span")).each(function(){this.innerHTML.charCodeAt(0)===8203&&(this.innerHTML=this.innerHTML.substr(1));this.innerHTML.length===0&&this.remove()}),i=this.m_oDocument.documentElement.outerHTML.replace(/\u200b/g,""),this._RemetStyleInterne(),$(this.m_oDocument.documentElement).attr("class",t),$(this.m_oDocument.body).attr("class",n),this._ActiveEcoute_SelectionChanged(),i)};WDSaisieAPI.prototype.GetProp_ValeurBody=function(){return this.m_oDocument.body.outerHTML};WDSaisieAPI.prototype.GetProp_ValeurPlain=function(){return this.m_oDocument.body.innerText};WDSaisieAPI.prototype.SetProp_ValeurBody=function(n){this.m_oDocument.body.outerHTML=n};WDSaisieAPI.prototype.CMD_RemoveClass=function(n){this.CMD_ChangeStyle(t=>{$(t).removeClass(n)})};WDSaisieAPI.prototype.CMD_RemoveClass_Filter_StartWith=function(n){this.CMD_ChangeStyle(t=>{t.classList.forEach(function(t,i,r){t.toString().startsWith(n)&&r.remove(n)})})};WDSaisieAPI.prototype.VisitTagsInRange=function(n){for(var f=this.__oGetSelection(),o=f.getRangeAt(0),e=document.createNodeIterator(document.body,NodeFilter.SHOW_TEXT),t,i=!1,u=$();t=e.nextNode();)if(t===r.startContainer&&(i=!0),i&&(u=u.add($(t.parentElement))),t===r.endContainer){i=!1;break}u.each(n)};WDSaisieAPI.prototype.CMD_AddAttribute=function(n,t){this.CMD_ChangeStyle(i=>{$(i).attr(n,t)},!0,!0)};WDSaisieAPI.prototype.CMD_CaretMemoireOuCommandRange=function(n,t,i){var r=this.__oGetSelection();r.type==="Caret"?this.CMD_ChangeStyle(t,!0,i):this.m_oDocument.execCommand(n)};WDSaisieAPI.prototype.CMD_SetFocus=function(){this.m_oDocument.documentElement.focus()};WDSaisieAPI.prototype.CMD_Imprimer=function(){window.print()};WDSaisieAPI.prototype.CMD_Gras=function(){var n=this.GetProp_Selection(!0);n&&(n=!!n.style.police.gras);this.CMD_CaretMemoireOuCommandRange("bold",t=>{t.style.fontWeight=n?"normal":"bold"})};WDSaisieAPI.prototype.CMD_Italique=function(){var n=this.GetProp_Selection(!0);n&&(n=!!n.style.police.italique);this.CMD_CaretMemoireOuCommandRange("italic",t=>{t.style.fontStyle=n?"normal":"italic"})};WDSaisieAPI.prototype.CMD_Souligne=function(){var n=this.GetProp_Selection(!0),t="none";n&&(t=n.style.police.barre?"line-through ":"",n=!!n.style.police.souligne);this.CMD_CaretMemoireOuCommandRange("underline",i=>{i.style.textDecoration=n?t||"none":t+"underline"},!0)};WDSaisieAPI.prototype.CMD_Barre=function(){var n=this.GetProp_Selection(!0),t="";n&&(t=n.style.police.souligne?"underline ":"",n=!!n.style.police.barre);this.CMD_CaretMemoireOuCommandRange("strikethrough",i=>{i.style.textDecoration=n?t||"none":t+"line-through"},!0)};WDSaisieAPI.prototype.CMD_Exposant=function(){var i=this.__oGetSelection(),r,n,t;if(this.bSelectionEstALaFin(i)&&(r=this.GetProp_Selection(!0),r.style.police.exposant)){n=this.m_oDocument.createElement("span");n.innerHTML="\u200b";t=this.m_oDocument.body.lastChild;t&&t.tagName=="DIV"?t.appendChild(n):this.m_oDocument.body.appendChild(n);i.selectAllChildren(this.m_oDocument.body);i.collapseToEnd();return}this.m_oDocument.execCommand("superscript")};WDSaisieAPI.prototype.CMD_Indice=function(){this.m_oDocument.execCommand("subscript")};WDSaisieAPI.prototype.CMD_AligneGauche=function(){var n=this.oGetRange(),t;n&&n.commonAncestorContainer&&n.commonAncestorContainer.querySelectorAll&&(t=n.commonAncestorContainer.querySelectorAll("div"),t.forEach(function(n){n.style&&n.style.textAlign&&(n.style.textAlign="")}));this.m_oDocument.execCommand("justifyLeft")};WDSaisieAPI.prototype.CMD_AligneCentre=function(){this.m_oDocument.execCommand("justifyCenter")};WDSaisieAPI.prototype.CMD_AligneDroite=function(){this.m_oDocument.execCommand("justifyRight")};WDSaisieAPI.prototype.CMD_AligneJustifie=function(){this.m_oDocument.execCommand("justifyFull")};WDSaisieAPI.prototype.CMD_AugmenteRetrait=function(){this.m_oDocument.execCommand("indent")};WDSaisieAPI.prototype.CMD_DiminueRetrait=function(){this.m_oDocument.execCommand("outdent")};WDSaisieAPI.prototype.CMD_ChangeCouleurTexte=function(n){this.m_oDocument.execCommand("foreColor",!1,n)};WDSaisieAPI.prototype.CMD_ChangeCouleurFondTexte=function(n){var t="transparent",f=this.__oGetSelection(),i,r,u;n=="-1"&&f.type==="Caret"&&(t="rgba(0, 0, 0, 0.01)",i=new MutationObserver((n,i)=>{for(var u,f,r=0;r<n.length;++r)for(u=0;u<(n[r].addedNodes||[]).length;++u)if(n[r].addedNodes[u]&&n[r].addedNodes[u].style&&n[r].addedNodes[u].style.backgroundColor===t){i.disconnect();f=n[r].addedNodes[u];f.style.backgroundColor="transparent";return}}),i.observe(this.m_oDocument,{attributes:!1,childList:!0,subtree:!0,characterData:!0}),r=()=>{i.disconnect(),this.m_oDocument.removeEventListener("selectionchange",r)},this.m_oDocument.addEventListener("selectionchange",r));u=this.m_oDocument.body.style.backgroundColor;this.m_oDocument.execCommand("hiliteColor",!1,n=="-1"?t:n);u!==this.m_oDocument.body.style.backgroundColor&&(this.m_oDocument.body.style.backgroundColor=u,this.m_oDocument.body.innerHTML='<span style="background-color:'+n+'">'+this.m_oDocument.body.innerHTML+"<\/span>")};WDSaisieAPI.prototype.CMD_ChangeCouleurFondDoc=function(n){n==-1&&(n=undefined);this.m_oDocument.body.style.backgroundColor=n;this.m_sDerniereValeurHtmlAffectee=undefined};WDSaisieAPI.prototype.SelectionneLienParent=function(){var t=this.__oGetSelection(),n,i;if(t.type!="None"&&(n=t.getRangeAt(0),i=n.commonAncestorContainer),n)for(elemParent=n.startContainer;elemParent;){if(elemParent.tagName=="A"){t.selectAllChildren(elemParent);return}elemParent=elemParent.parentElement}};WDSaisieAPI.prototype.CMD_ChangeLien=function(n){this.SelectionneLienParent();this.m_oDocument.execCommand("createLink",!1,n);this.m_sDerniereValeurHtmlAffectee=undefined};WDSaisieAPI.prototype.CMD_SupprimeLien=function(){this.SelectionneLienParent();this.m_oDocument.execCommand("unlink");this.m_sDerniereValeurHtmlAffectee=undefined};WDSaisieAPI.prototype.CMD_AugmenteTaillePolice=function(){this.CMD_ChangeStyle(n=>{oStyleEffectif=this.oGetCurrentStyle(n);var t=parseInt(oStyleEffectif.fontSize);t+=t<14?1:2;n.style.fontSize=t+"px"},!0)};WDSaisieAPI.prototype.CMD_DiminueTaillePolice=function(){this.CMD_ChangeStyle(n=>{oStyleEffectif=this.oGetCurrentStyle(n);var t=parseInt(oStyleEffectif.fontSize);t<=4||(t-=t<14?1:2,n.style.fontSize=t+"px")},!0)};WDSaisieAPI.prototype.CMD_ChangeNomPolice=function(n){this.m_oDocument.execCommand("fontName",!1,n)};WDSaisieAPI.prototype.CMD_CreePuceAvecNumero=function(){this.m_oDocument.execCommand("insertOrderedList")};WDSaisieAPI.prototype.CMD_CreePuceSansNumero=function(){this.m_oDocument.execCommand("insertUnorderedList")};WDSaisieAPI.prototype.CMD_AddClass=function(n){this.CMD_ChangeStyle(t=>{$(t).addClass(n)})};WDSaisieAPI.prototype.CMD_GetTexteSelection=function(){var n=this.__oGetSelection();return n.toString()};WDSaisieAPI.prototype.Set_VerifieOrthographe=function(){this.m_oDocument.documentElement.spellcheck="false"};WDSaisieAPI.prototype.CMD_Copier=function(){this.m_oDocument.execCommand("copy")};WDSaisieAPI.prototype.CMD_Couper=function(){this.m_oDocument.execCommand("cut")};WDSaisieAPI.prototype.CMD_Coller=function(n){var t=this.oGetRange();t.deleteContents();newNode=document.createTextNode(n);t.insertNode(newNode);t.select&&(t.select(),t.collapse(!1),t.scrollIntoView())};WDSaisieAPI.prototype.CMD_CollerHtml=function(n){this.CMD_InsereHtml(n)};WDSaisieAPI.prototype.__oGetSelection=function(){var n=this.m_oDocument.defaultView;return n&&n.getSelection?n.getSelection():this.m_oDocument.getSelection?this.m_oDocument.getSelection():undefined};WDSaisieAPI.prototype.oGetRange=function(){var n=this.__oGetSelection();return n&&n.rangeCount?n.getRangeAt(0):null};WDSaisieAPI.prototype.oGetCurrentStyle=function(n,t){var u=()=>{var t;if(n.currentStyle)return n.currentStyle;if(t=n.defaultView||(n.ownerDocument||this.m_oDocument).defaultView,t.getComputedStyle){n.nodeName=="#text"&&(n=n.parentNode);try{return t.getComputedStyle(n,null)}catch(i){return{}}}return{}},i=u(),r;return t?(r=$.extend({},i),this.MAJStyleSelonParentR(r,i),r):i};WDSaisieAPI.prototype.MAJStyleSelonParentR=function MAJStyleSelonParentR(n,t){var i,r,u;if(n.parentElement&&Element.parentElement!=this.m_oDocument.body){if(i=this._nGetAlphaColor(t.backgroundColor)===0,r=t.textDecorationLine==="none",!i&&!r)return;if(u=oGetCurrentStyle(n.parentElement,!1),i&&this._nGetAlphaColor(u.backgroundColor)!==0&&(t.backgroundColor=u.backgroundColor,i=!1),r&&u.textDecorationLine!=="none"&&(t.textDecorationLine=u.textDecorationLine,r=!1),!i&&!r)return;MAJStyleSelonParentR(n.parentElement,t)}};WDSaisieAPI.prototype.CMD_ChangeTaillePolice=function(n){this.CMD_ChangeStyle(t=>{t.style.fontSize=n},!0)};WDSaisieAPI.prototype.EmpileUndoRedo=function(n,t,i){var o,r,s,u,f,e,h;return this.m_bUndoRedoEnCours=!0,o=this.saveSelection(),r=n[0],r.classList.add("wbEmpileUndoRedo"),s=r.outerHTML,u=t(),u&&r.parentElement&&(f=this.__oGetSelection(),e=this.m_oDocument.createRange(),f.removeAllRanges(),r.classList.remove("wbEmpileUndoRedo"),h=r.outerHTML,r.classList.add("wbEmpileUndoRedo"),r.outerHTML=s,r=this.m_oDocument.body.getElementsByClassName("wbEmpileUndoRedo")[0],r.classList.remove("wbEmpileUndoRedo"),e.selectNode(r),f.addRange(e),this.m_oDocument.execCommand("insertHTML",!1,h),n=$(f.focusNode).closest(r.tagName.toLowerCase())),this.restoreSelection(o),i&&(u=i(u,n)),this.m_bUndoRedoEnCours=!1,u};WDSaisieAPI.prototype.CMD_ChangeStyle=function(n,t,i){var s=this.__oGetSelection(),o,y,p,b,l,a,k,c;if(s.type!=="None"){var f=s.getRangeAt(0),u=f.cloneRange(),d=this.saveSelection(),r=this.m_oDocument.body,v=()=>{var n;return n=u.commonAncestorContainer.nodeType==Node.TEXT_NODE?u.commonAncestorContainer.parentElement:u.commonAncestorContainer,n||r},e=!1;if(s.type==="Caret"){if(t){this._DesactiveEcoute_SelectionChanged();o=this.m_oDocument.createElement("span");o.appendChild(this.m_oDocument.createTextNode(String.fromCharCode(8203)));y=f.startOffset===f.endOffset&&f.endOffset===f.commonAncestorContainer.length;i&&y&&f.commonAncestorContainer.nodeType==Node.TEXT_NODE&&f.commonAncestorContainer.parentElement&&f.commonAncestorContainer.parentElement.parentElement&&this.m_oDocument.body!==f.commonAncestorContainer.parentElement?f.commonAncestorContainer.parentElement.parentElement.insertBefore(o,f.commonAncestorContainer.parentElement.nextSibling):f.insertNode(o);o.previousElementSibling&&o.previousElementSibling.innerHTML===String.fromCharCode(8203)&&(o=o.previousElementSibling,o.nextElementSibling.remove());n(o);f.selectNode(o);f.collapse();this._ActiveEcoute_SelectionChanged();return}e=!0;r=v()}else u.startContainer===u.endContainer&&u.endContainer==u.commonAncestorContainer?(u.startOffset===0&&u.endOffset===u.commonAncestorContainer.length&&(e=!0),r=v()):u.startOffset===0&&u.commonAncestorContainer.firstChild===u.startContainer&&u.commonAncestorContainer.lastChild===u.endContainer&&u.endContainer.length===u.endOffset?(e=!0,r=v()):r=u.commonAncestorContainer||r;e&&r===this.m_oDocument.body&&(e=!1);this._DesactiveEcoute_SelectionChanged();r=$(r)[0];p=[];r.querySelectorAll(this.m_oOptions.bEnModeMail?"font[face]":"[style*='font-family']").forEach(n=>{n.dataset.wdFontFamilyPrecedente=this.m_oOptions.bEnModeMail?n.face:n.style.fontFamily,p.push(n)});var g=r.outerHTML,tt=r.innerHTML,h=e?r.outerHTML:r.innerHTML,nt=this.m_oDocument.body.innerHTML,w=!1;e||(b=this.m_oDocument.documentElement.outerHTML,this.m_oDocument.execCommand("fontName",!1,"WINDEVFONTNAME"),w=b!==this.m_oDocument.documentElement.outerHTML);l=!1;this.m_oDocument.body.querySelectorAll("[style*=WINDEVFONTNAME]").forEach(n=>{$.contains(r,n)||r===n||(l=!0)});l&&(r=this.m_oDocument.body,e=!1,h=nt);a=e?[r]:r.querySelectorAll(this.m_oOptions.bEnModeMail?"[face*=WINDEVFONTNAME]":"[style*=WINDEVFONTNAME]");a.length===0&&(this.m_oOptions.bEnModeMail?r.face==="WINDEVFONTNAME":r.style.fontFamily==="WINDEVFONTNAME")&&(a=[r],h=g,e=!0);a.forEach(t=>{!t.dataset.wdFontFamilyPrecedente&&l&&t.previousElementSibling&&t.previousElementSibling.style.fontFamily.length&&(t.dataset.wdFontFamilyPrecedente=t.previousElementSibling.style.fontFamily),t.style.fontfamily=t.dataset.wdFontFamilyPrecedente?t.dataset.wdFontFamilyPrecedente:"",n(t),t.dataset=undefined});this.m_oDocument.querySelectorAll("[data-wd-font-family-precedente]").forEach(n=>{this.m_oOptions.bEnModeMail?n.face=n.dataset.wdFontFamilyPrecedente:n.style.fontFamily=n.dataset.wdFontFamilyPrecedente,n.dataset=undefined});this.m_oDocument.querySelectorAll(this.m_oOptions.bEnModeMail?"[face*=WINDEVFONTNAME]":"[style*=WINDEVFONTNAME]").forEach(n=>{n.style.fontFamily=""});this.m_oOptions.bSansUndoRedoNatif||(k=e?r.outerHTML:r.innerHTML,w?(this.m_oDocument.execCommand("undo",!1),e&&(r=u.commonAncestorContainer)):e?(r.outerHTML=h,(u.commonAncestorContainer.parentElement||u.commonAncestorContainer).querySelectorAll("*").forEach(n=>{n.outerHTML===h&&(r=n)})):r.innerHTML=h,c=this.m_oDocument.createRange(),e?(c.setStart(r,0),c.setEnd(r,r.childNodes.length)):c.selectNodeContents(r),s.removeAllRanges(),s.addRange(c),this.m_oDocument.execCommand("insertHTML",!1,k));this.restoreSelection(d);this._ActiveEcoute_SelectionChanged()}};WDSaisieAPI.prototype.nGetIndiceDocumentWLDepuisIndiceNoeud=function(n,t){for(var u=this.m_oDocument.createNodeIterator(this.m_oDocument.body,NodeFilter.SHOW_TEXT),i,r=0;i=u.nextNode();){if(i!=n){r+=i.textContent.length;continue}return r+t}return-1};WDSaisieAPI.prototype.CreateRangeDepuisIndice=function(n,t,i,r){var h;n<0&&(n=0);for(var o="",v=this.m_oDocument.createNodeIterator(i||this.m_oDocument.body,NodeFilter.SHOW_TEXT),f,u,s,e=n,c=e+t,l,a;f=v.nextNode();){if(o+=f.textContent,!u&&o.length>n?s=u=f:u||o.length!==n||t!==0||(l=f,a=e),u&&o.length>=n+t){s=f;break}u||(e-=f.textContent.length);c-=f.textContent.length}try{r&&u.parentElement&&u.parentElement.scrollIntoView();!u&&l&&(s=u=l,c=e=a);h=this.m_oDocument.createRange();h.setStart(u,e);h.setEnd(s,c)}catch(y){}return h};WDSaisieAPI.prototype.CMD_SelectionneTexte=function(n,t,i,r){var e=this.__oGetSelection(),o=this.CreateRangeDepuisIndice(t,n.length,i,!0),f,u;e.removeAllRanges();e.addRange(o);r&&(f=this.m_oDocument.createElement("style"),f.innerHTML="::selection{ background:orange; }",u=this,u._DesactiveEcoute_SelectionChanged(),this.m_oDocument.body.appendChild(f),setTimeout(()=>{var n=function(){u._DesactiveEcoute_SelectionChanged();f.remove();u._ActiveEcoute_SelectionChanged();u.m_oDocument.removeEventListener("selectionchange",n)};this.m_oDocument.addEventListener("selectionchange",n)},1),u._ActiveEcoute_SelectionChanged())};WDSaisieAPI.prototype.__nGetIndiceDocumentWLDepuisIndiceBalise=function(n,t){var u;this._DesactiveEcoute_SelectionChanged();var f=this.saveSelection(),i=this.m_oDocument.createRange(),r=this.__oGetSelection();return i.setStart(this.m_oDocument.body,0),i.setEndBefore(n),r.removeAllRanges(),r.addRange(i),u=this.m_oDocument.createElement("p"),u.insertBefore(i.cloneContents(),undefined),r.removeAllRanges(),this.restoreSelection(f),this._ActiveEcoute_SelectionChanged(),t+u.innerText.length};WDSaisieAPI.prototype.__sGetInnerTextAvecRC=function(n){for(var t="",r=this.m_oDocument.createNodeIterator(n||this.m_oDocument.body,NodeFilter.SHOW_TEXT),i;i=r.nextNode();)t+=i.textContent;return t};WDSaisieAPI.prototype.CMD_RechercheTout=function(n,t,i,r){var u,f,o,a,h,s;n=n.replace(new RegExp(String.fromCharCode(160),"g")," ");var v=new RegExp(i?"(^|[^a-zA-Z0-9])"+n+"([^a-zA-Z0-9]|$)":n,"g"+(t?"i":"")),e={},y=this.m_oDocument.createNodeIterator(this.m_oDocument.body,NodeFilter.SHOW_TEXT),c=0,l={};for(u=undefined;u=y.nextNode();c+=u.textContent.length)if(u.previousElementSibling||(l[u.parentElement.uuidv4||(u.parentElement.uuidv4=WDSaisieAPI.uuidv4())]=c),f=u.textContent,o=c,!u.nextElementSibling&&u.parentElement.innerText&&u.parentElement.uuidv4&&(o=l[u.parentElement.uuidv4],f=this.__sGetInnerTextAvecRC(u.parentElement)),f){f=f.replace(new RegExp(String.fromCharCode(160),"g")," ");a=f.matchAll(v);for(h of a)if((s=i&&h[1]!=""?h.index+1:h.index,!e[s+o])&&(e[s+o]={domBalise:u.parentElement,nIndice:s,nIndiceDocument:s+o},r&&r===Object.values(e).length))return e.pop()}return Object.values(e)};WDSaisieAPI.prototype.CMD_Recherche=function(n,t,i,r){for(var e,s,f=[],o=this.CMD_RechercheTout(n,t,i),u=0;u<o.length;u++)if(e=o[u],s=this._nCalcTailleTexteAvantElem(e.domBalise,0)+e.nIndice,f.push(s),r&&r!=-1&&u>=r-1)break;return f.push(-1),f.toString()};WDSaisieAPI.prototype.CMD_RemplaceTout=function(n,t,r,u){var e=this.CMD_RechercheTout(n,r,u),f;for(i=e.length-1;i>=0;i--)f=e[i],this.CMD_SelectionneTexte(n,f.nIndice,f.domBalise,!1),this.CMD_InsereHtml(t)};WDSaisieAPI.prototype.CMD_SelectionFin=function(){var n=this.__oGetSelection();n.selectAllChildren(this.m_oDocument.body);n.collapseToEnd()};WDSaisieAPI.prototype.CMD_SelectionTout=function(){var n=this.__oGetSelection();n.selectAllChildren(this.m_oDocument.body)};WDSaisieAPI.prototype.saveSelection=function(){var i=this.m_oDocument.body,t=this.__oGetSelection().getRangeAt(0),n=t.cloneRange();return{range:n,nIndiceDocumentDebut:this.nGetIndiceDocumentWLDepuisIndiceNoeud(n.startContainer,n.startOffset),nIndiceDocumentFin:this.nGetIndiceDocumentWLDepuisIndiceNoeud(n.endContainer,n.endOffset)}};WDSaisieAPI.prototype.restoreSelection=function(n){var i=this.CreateRangeDepuisIndice(n.nIndiceDocumentDebut,n.nIndiceDocumentFin-n.nIndiceDocumentDebut),t=this.__oGetSelection();t.removeAllRanges();t.addRange(i)};WDSaisieAPI.prototype.GetProp_Selection_JSON=function(){var n=this.GetProp_Selection();return JSON.stringify(n)};WDSaisieAPI.prototype.GetProp_SelectionSimplifiee=function(){var n=this.GetProp_Selection();let t=JSON.stringify(n);return String(n.debut)+";"+String(n.fin)};WDSaisieAPI.prototype.bEstGras=function(n){if(isNaN(n))switch(n){case"lighter":case"normal":return!1;case"bold":case"bolder":return!0;default:return!1}var t=parseInt(n,10);return t>400};const EActionVisite={stop:"1",frereSuivant:"2",premierFils:"3",frereParent:"4"};WDSaisieAPI.prototype.visisteElementDOM=function(n,t,i){if(n&&n!=t){let r=n,u=r.nextSibling;while(r){var f=i(r);switch(f){case EActionVisite.stop:return;case EActionVisite.frereSuivant:u=r.nextSibling;break;case EActionVisite.premierFils:u=r.firstChild;break;case EActionVisite.frereParent:if(!r.parentNode)return;u=r.parentNode.nextSibling}if(r==t)return;r=u}}};WDSaisieAPI.prototype.visisteElementPrincipauxEntre=function(n,t,i){this.visisteElementDOM(n,t,r=>r.contains(t)?EActionVisite.premierFils:(r!=n&&r!=t&&i(r),!r.nextSibling)?EActionVisite.frereParent:EActionVisite.frereSuivant)};WDSaisieAPI.prototype.visitePourStyle=function(n,t,i){i(n);this.visisteElementDOM(n,t,r=>r.contains(t)?EActionVisite.premierFils:(r!=n&&i(r),!r.nextSibling)?EActionVisite.frereParent:EActionVisite.frereSuivant)};WDSaisieAPI.prototype._nCalcTailleTexteAvantElem=function(n,t,i=true){var h,f,a,u;let e=this.m_oDocument.body;while(e.firstChild)e=e.firstChild;var r=t,c=!1,l=!1,o=!1;n.nodeName==="#text"&&r===0&&n.textContent!==""&&n.parentElement&&n.parentElement.nodeName==="DIV"&&n.parentElement.previousSibling&&(n.parentElement.previousSibling.nodeName=="#text"||n.parentElement.previousSibling.nodeName=="DIV")?l=!0:n.nodeName==="#text"&&r>0&&r-1<n.textContent.length-1&&n.textContent[r-1]===" "&&(c=!0);n.nodeName==="#text"&&r===0&&n.textContent.length>0&&(o=!0,r++);n.nodeName==="#text"&&r===1&&n.textContent.length>1&&n.textContent[0]==="\n"&&(o=!0,r++);let s=this.m_oDocument.createRange();return s.setStart(e,0),s.setEnd(n,r),documentFragment=s.cloneContents(),i&&this._DesactiveEcoute_SelectionChanged(),h=this.m_oDocument.body,f=this.m_oDocument.createElement("div"),f.appendChild(documentFragment),h.appendChild(f),a=f.innerText,u=a.length,c&&u++,l&&u++,o&&u>0&&u--,h.removeChild(f),i&&this._ActiveEcoute_SelectionChanged(),u-t};WDSaisieAPI.prototype._oCalcElemeFromPos=function(n){var t={elem:this.m_oDocument.body,offsetDansElem:0,bTrouve:!1},i;return elementDebut=this.m_oDocument.body.firstChild,this._DesactiveEcoute_SelectionChanged(),i=0,this.visisteElementDOM(elementDebut,null,r=>{var u=0,f=0,o,s,h,c,a;if(r.innerText)u=r.innerText.length;else if(r.nodeName==="BR")u++;else if(r.nodeName==="#text"&&r.parentElement&&r.parentElement.nodeName!="STYLE")if(o=r.textContent.length,i+o+2<n)u=o;else{var v=r.cloneNode(),l=r.parentElement,e=this.m_oDocument.createElement("div");e.appendChild(v);l.appendChild(e);s=e.innerText;l.removeChild(e);u=s.length;f=r.textContent.indexOf(s);f<0&&(f=0)}return(i+u+2>=n-2&&(h=this._nCalcTailleTexteAvantElem(r,0,!1),h>i&&(i=h)),i+u>=n)?(t.elem=r,t.offsetDansElem=u,t.bTrouve=!0,i===n)?(t.elem=r,t.offsetDansElem=0,t.bTrouve=!0,EActionVisite.stop):(c=i+u==n,r.firstChild&&this._nCalcTailleTexteAvantElem(r.firstChild,0)!=i&&(c=!1),c)?(t.elem=r,t.offsetDansElem=r.nodeName=="#text"?u+f:r.childNodes.length,t.bTrouve=!0,EActionVisite.stop):r.firstChild?EActionVisite.premierFils:(t.elem=r,t.offsetDansElem=n-i+f,t.offsetDansElem>u+f&&(t.offsetDansElem=u+f),t.offsetDansElem<0&&(t.offsetDansElem=0),t.bTrouve=!0,a=this._nCalcTailleTexteAvantElem(t.elem,t.offsetDansElem)+t.offsetDansElem,a===n-1&&t.offsetDansElem++,EActionVisite.stop):(i+=u,!r.nextSibling)?EActionVisite.frereParent:EActionVisite.frereSuivant}),this._ActiveEcoute_SelectionChanged(),t};WDSaisieAPI.prototype.CMD_Selectionne=function(n,t){var f,e;this._DesactiveEcoute_SelectionChanged();try{var o=this.__oGetSelection(),i=this.m_oDocument.createRange(),r=this._oCalcElemeFromPos(n),u=this._oCalcElemeFromPos(t);i.selectNodeContents(r.elem);f=i.endOffset;r.bTrouve||(r.offsetDansElem=n<1?0:f);i.selectNodeContents(u.elem);e=i.endOffset;u.bTrouve||(u.offsetDansElem=t<1?0:e);i.setStart(r.elem,Math.min(f,r.offsetDansElem));i.setEnd(u.elem,Math.min(e,u.offsetDansElem));o.removeAllRanges();o.addRange(i)}catch(s){}this._ActiveEcoute_SelectionChanged()};WDSaisieAPI.prototype.CorrigeSelectionMot=function(){var t=this.__oGetSelection(),n,r,i;(t.type!="None"&&(n=t.getRangeAt(0),r=n.commonAncestorContainer),n)&&(i=t.toString(),i.slice(-1)==" "&&n.endOffset>0&&n.setEnd(n.endContainer,n.endOffset-1))};WDSaisieAPI.prototype.GetProp_Selection=function(n){function h(n,i=0,r=-1){let u={html:""};u.texte=n.textContent;n.outerHTML?u.html=n.outerHTML:n.innerHTML&&(u.html=n.innerHTML);u.debut=i;u.fin=r==-1?u.texte.length:r;t.fragment.push(u)}var t={},e,i,f,u,s,r,l;this._DesactiveEcoute_SelectionChanged();e=this.__oGetSelection();e.type!="None"&&(i=e.getRangeAt(0),f=i.commonAncestorContainer);let o=!0;if(i&&(o=i.startContainer==i.endContainer),f&&(u=this.oGetCurrentStyle(f,!0)),t.type=0,e.type=="None"&&(t.type=-1),e.type=="Caret"&&(t.type=0),e.type=="Range"&&(t.type=e.rangeCount>1?2:1),t.texte=e.toString(),t.html="",f&&(f.outerHTML&&!s?t.html=f.outerHTML:f.innerHTML?t.html=f.innerHTML:f.nodeName=="#text"&&(t.html=f.parentNode.innerHTML),s=e.containsNode(this.m_oDocument.body),s&&(t.html=this.m_oDocument.body.outerHTML)),i&&!n){let n=this._nCalcTailleTexteAvantElem(i.startContainer,i.startOffset);t.debut=n+i.startOffset;t.fin=t.debut+t.texte.length}else t.debut=0,t.fin=0;if(t.style={nom:""},t.style.police={gras:!1,italique:!1,souligne:!1,barre:!1,indice:!1,exposant:!1,alignement:0,couleur:-1,couleurFond:-1,opaciteCouleurFond:0,nom:"",taille:""},u&&u.textDecorationLine)for(t.style.police.gras=this.bEstGras(u.fontWeight),t.style.police.italique=u.fontStyle=="italic"||u.fontStyle=="oblique",t.style.police.souligne=u.textDecorationLine.includes("underline"),t.style.police.barre=u.textDecorationLine.includes("line-through"),t.style.police.barre&&(t.style.police.souligne=this.m_oDocument.queryCommandState("underline")),t.style.police.indice=u.verticalAlign.includes("sub"),t.style.police.exposant=u.verticalAlign.includes("super"),t.style.police.alignement=0,u.textAlign=="center"&&(t.style.police.alignement=1),u.textAlign=="right"&&(t.style.police.alignement=2),t.style.police.couleur=this._nCouleurJSversWin32(u.color),t.style.police.couleurFond=this._nCouleurJSversWin32(u.backgroundColor),t.style.police.opaciteCouleurFond=this._nGetAlphaColor(u.backgroundColor),t.style.police.nom=u.fontFamily,t.style.police.taille=u.fontSize,this.visitePourStyle(i.startContainer,i.endContainer,n=>{var i=this.oGetCurrentStyle(n);i.textAlign!=u.textAlign&&(t.style.police.alignement=-1);i.color!=u.color&&(t.style.police.couleur=-1);i.backgroundColor!=u.backgroundColor&&(t.style.police.couleurFond=-1,t.style.police.opaciteCouleurFond=0);i.fontFamily!=u.fontFamily&&(t.style.police.nom="");i.fontSize!=u.fontSize&&(t.style.police.taille="")}),t.style.nom="",i&&(r=i.startContainer);r;){if(r.tagName=="H1"||r.tagName=="H2"||r.tagName=="H3"||r.tagName=="H4"||r.tagName=="H5"||r.tagName=="H6"){t.style.nom=r.tagName;break}if((r.tagName=="SPAN"||r.tagName=="P"||r.tagName=="DIV")&&r.className&&r.className!="undefined"){t.style.nom=r.className;break}r=r.parentElement}if(t.URL="",i)for(r=i.startContainer;r;)r.tagName=="A"&&(t.URL=r.href),r=r.parentElement;t.fragment=[];l=i?i.startContainer:undefined;let c=-1;return o&&i&&(c=i.endOffset),i&&(h(i.startContainer,i.startOffset,c),o||(this.visisteElementPrincipauxEntre(i.startContainer,i.endContainer,n=>{h(n)}),h(i.endContainer,0,i.endOffset))),this._ActiveEcoute_SelectionChanged(),t};WDSaisieAPI.prototype.CMD_InsereHtml=function(n){this.m_sDerniereValeurHtmlAffectee=undefined;this.m_oDocument.execCommand("insertHTML",!1,n)};WDSaisieAPI.prototype.CMD_ForceStyleH=function(n){var t=this.__oGetSelection(),i=t.toString(),f,r,u,e;i!=""||t.type=="None"||this.bSelectionEstALaFin(t)||(f=t.getRangeAt(0),r=f.commonAncestorContainer,r.nodeName=="#text"&&(u=this.m_oDocument.createRange(),u.selectNode(r),t.removeAllRanges(),t.addRange(u)),i=t.toString());i==""&&(i="\u200b");e="<"+n+">"+i+"<\/"+n+">";this.CMD_InsereHtml(e)};WDSaisieAPI.prototype.CMD_ChangeNomStyleCss=function(n){this.CMD_ChangeStyle(t=>{t.className=n})};WDSaisieAPI.prototype.oGetHxParent=function(n){for(n.nodeName=="#text"&&(n=n.parentNode);n;){if(n.tagName=="H1"||n.tagName=="H2"||n.tagName=="H3"||n.tagName=="H4"||n.tagName=="H5"||n.tagName=="H6")return n;n=n.parentElement}return null};WDSaisieAPI.prototype.CMD_SupprimeStyleCss=function(){var n=this.__oGetSelection(),i,t,f,r,u;if(n.type!="None"&&(range_0=n.getRangeAt(0),i=range_0.commonAncestorContainer),n=this.__oGetSelection(),i&&(t=this.oGetHxParent(i)),t){f=this.m_oDocument.createRange();r=t.innerHTML;t.outerHTML=r;return}u=n.toString();this.CMD_InsereHtml(u)};WDSaisieAPI.prototype.GetProp_Document_JSON=function(){var n={};n.texte=this.m_oDocument.documentElement.innerText;n.html=this.m_oDocument.documentElement.outerHTML;return JSON.stringify(n)};WDSaisieAPI.prototype._nCouleurJSversWin32=function(n){if(!n)return-1;var t=n.replace(/[^\d,]/g,"").split(",");return(t.length=3)?parseInt(t[0])+parseInt(t[1])*256+parseInt(t[2])*65536:(t.length=4)?parseInt(t[1])+parseInt(t[2])*256+parseInt(t[3])*65536:-1};WDSaisieAPI.prototype._nGetAlphaColor=function(n){var t=n.replace(/[^\d,]/g,"").split(",");return t.length<4?255:parseInt(t[0])};WDSaisieAPI.prototype.GetListeTousLesStyles=function(){function p(n){return n.replace(/(\-[a-z])/g,function(n){return n.toUpperCase().replace("-","")})}for(var t,i,v,c,o,l,a,f,r,y,u,e,s,n={tabNomClass:[],"class":{}},h=0;h<this.m_oDocument.styleSheets.length;++h)if(t=this.m_oDocument.styleSheets[h],!this.m_tabBaliseCssAjoutee.filter(n=>n===t.ownerNode).length)try{for(i=0;i<t.cssRules.length;++i)if(!(!t.cssRules[i]instanceof CSSStyleRule)&&t.cssRules[i].selectorText)for(v=t.cssRules[i].selectorText.trim(),c=v.split(","),o=0;o<c.length;++o)(l=c[o].trim(),l.indexOf(".")===0)&&(a=l.substr(1).split(/[^A-Za-z0-9\-\_]+/g),f=a[0],n.class[f]&&a.length!==1||(n.class[f]||n.tabNomClass.push(f),n.class[f]=t.cssRules[i]))}catch(w){continue}r=$("<p style='visibility:hidden;position:fixed;top:-999999px;left:-999999px;'/>");$(this.m_oDocument.body).append(r);y=$.extend({},this.m_oWindow.getComputedStyle(r[0]));for(sClass in n.class)for(r.attr("class",sClass),u=this.m_oWindow.getComputedStyle(r[0]),n.class[sClass]={style:{}},e=0;e<u.length;++e)(s=p(u[e]),y[s]!==u[s])&&(n.class[sClass].style[u[e]]=u[s]);return r.remove(),JSON.stringify(n)};WDSaisieAPI.prototype.Get_UndoRedoStatus=function(){var n={};n.undoOk=this.m_oDocument.queryCommandEnabled("undo");n.redoOk=this.m_oDocument.queryCommandEnabled("redo");return JSON.stringify(n)};WDSaisieAPI.prototype.bSelectionEstALaFin=function(n){if(!n.isCollapsed||n.type=="None"||n.containsNode(this.m_oDocument.body.lastChild))return!1;range_0=n.getRangeAt(0);selParent=range_0.commonAncestorContainer;var t=range_0.endContainer;return(t.nodeName=="#text"&&(t=t.parentNode),nLen=t.innerText.length,range_0.endOffset<nLen)?!1:!0};WDSaisieAPI.prototype.sGetWLEXEC=function(n){var t=n;try{t=eval(n)}catch(i){return n}return t};WDSaisieAPI.prototype.sGetTraduction=function(n,t){if(!window.HTML_TOOLBAR)return n;var i;try{i=eval(n)}catch(r){return n}return t!==undefined?i[t]:i};WDSaisieAPI.prototype.CreerRangeSelectionTexteSurBaliseCible=function(n,t){var r=this.m_oDocument.createRange(),f=this.__oGetSelection(),u,i;return n.tagName.toLowerCase()==="img"?r.selectNode(n):r.selectNodeContents(n),f.removeAllRanges(),t&&(u=this.m_oDocument.createElement("style"),u.innerHTML="::selection{ background:transparent; }",i=this,i._DesactiveEcoute_SelectionChanged(),this.m_oDocument.body.appendChild(u),setTimeout(()=>{var n=function(){i._DesactiveEcoute_SelectionChanged();u.remove();i._ActiveEcoute_SelectionChanged();i.m_oDocument.removeEventListener("selectionchange",n)};this.m_oDocument.addEventListener("selectionchange",n)},1),i._ActiveEcoute_SelectionChanged()),f.addRange(r),r};WDSaisieAPI.prototype.JSEXEC_ElementCourant=function(n,t){var r,i;if(this.m_oElementCourant&&this.m_oElementCourant[n]){for(r=[],i=1;i<arguments.length;++i)r.push(arguments[i]);if(!t||!t.id||!this.m_oElementCourant.id||this.m_oElementCourant.id===t.id)return this.m_oElementCourant[n].apply(this,r)}};WDSaisieAPI.prototype.__InitGestionJS=function(){function nt(n){return $.extend({},n[0].getBoundingClientRect(),{left:n.offset().left+parseInt(getComputedStyle(n[0]).borderLeftWidth),top:n.offset().top+parseInt(getComputedStyle(n[0]).borderTopWidth),width:n[0].clientWidth||n[0].offsetWidth,height:n[0].clientHeight||n[0].offsetHeight,transform:n[0].style.transform,marginTop:parseFloat(n[0].style.marginTop||0),marginRight:n[0].style.marginRight=="auto"?0:parseFloat(n[0].style.marginRight||0),marginBottom:parseFloat(n[0].style.marginBottom||0),marginLeft:n[0].style.marginLeft=="auto"?0:parseFloat(n[0].style.marginLeft||0)})}function ni(n,t,i){(i||n.attr)&&k.forEach(function(r){(!i||t[0].hasAttribute(r))&&(i?(n||(n={}),n.attr||(n.attr={}),n.attr[r]=t.attr(r)):t.attr(r,n.attr[r]))})}function ti(n,t,i){var u,r;if(i)for(u=0;u<t[0].style.length;++u)n.style||(n.style={}),r=t[0].style[u],n.style[r]=t[0].style[jQuery.camelCase(r)];else{if(!n.style)return;for(r in n.style)t.css(r,n.style[r])}}function tt(n,t,i){ni(n,t,i);ti(n,t,i)}function vt(t,i,r){var u=$('<div class="wbSaisieRicheModalGFI" contenteditable="false"><\/div>'),v=$('<div class="wbSaisieRicheModal"><\/div>'),f,e,y,h,c,o,s,l,a;return u.append(v),f=$('<div class="wbSaisieRicheModalContenu"><\/div>'),v.append(f),e=$('<div class="wbSaisieRicheModalContenuEntete"><\/div>'),f.append(e),y=$('<h5 class="wbSaisieRicheModalContenuTitre">'+i[0].tagName+"<\/h5>"),e.append(y),h=$('<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">\u00d7<\/span><\/button>'),h.click(function(){u.remove()}),e.append(h),c=$('<div class="wbSaisieRicheModalContenuCorps"><\/div>'),f.append(c),o=$("<dl><\/dl>"),c.append(o),s=$('<div class="wbSaisieRicheModalContenuPied"><\/div>'),f.append(s),l=$('<button type="button" class="wbSaisieRicheModalBoutonAnnuler" data-dismiss="modal">Annuler<\/button><\/div>'),l.click(function(){u.remove()}),s.append(l),a=$('<button type="button" class="wbSaisieRicheModalBoutonOK">OK<\/button>          <\/div>'),a.click(function(){t(r);u.remove()}),s.append(a),n.append(u),{ajouteChampFormulaire:function(n,t,i,r,u){var e=r?"attr":"style",f=t[e][i]||"",s,l,h,c;u||(u=typeof f=="number"?"range":"text");u==="range"||u==="number"?f=f?parseFloat(f):0:u==="color"&&(s=clWDUtil.tabHTML2RVBA(f),f="#"+s[0].toString(16)+s[1].toString(16)+s[2].toString(16));l=$("<dt>"+n+"<\/dt>");o.append(l);h=$("<dd><\/dd>");o.append(h);c=$('<input type="'+u+'" value="'+f+'" title="'+f+'"/>');c.on("change",function(){t[e][i]=this.value;(u==="range"||u==="number")&&(t[e][i]+="px");this.title=t[e][i]});h.append(c)},ajouteAttrStyle:function(n){this.ajouteAttr(n);this.ajouteStyle(n)},ajouteAttr:function(n){n.attr&&k.forEach((t,i)=>{this.ajouteChampFormulaire(k[i],n,k[i],!0)})},ajouteStyle:function(n){n.style&&(this.ajouteChampFormulaire("Couleur de fond",n,"background-color",!1,"color"),this.ajouteChampFormulaireBordures(n))},ajouteChampFormulaireBorduresCote:function(n,t){this.ajouteChampFormulaire("Epaisseur de bordure "+t,n,"border-"+t+"-width",!1,"range");this.ajouteChampFormulaire("Style de bordure "+t,n,"border-"+t+"-style",!1,"text");this.ajouteChampFormulaire("Couleur de bordure "+t,n,"border-"+t+"-color",!1,"color")},ajouteChampFormulaireBordures:function(n){this.ajouteChampFormulaireBorduresCote(n,"top");this.ajouteChampFormulaireBorduresCote(n,"right");this.ajouteChampFormulaireBorduresCote(n,"bottom");this.ajouteChampFormulaireBorduresCote(n,"left")}}}function yt(i){function f(n,t){var i=t===undefined;return t||(t={id:WDSaisieAPI.uuidv4(),table:{tr:[]}}),tt(t.table,n,i),n.add(n.children("tbody,thead,tfoot")).children("tr").each(function(n){var f=$(this),u=n<t.table.tr.length?t.table.tr[n]:t.table.tr[t.table.tr.push({td:[]})-1];tt(u,f,i);f.children("td,th").each(function(n){var t=n<u.td.length?u.td[n]:u.td[u.td.push({})-1];i&&this===r[0]&&(t.focus=!0);tt(t,$(this),i)})}),i?JSON.stringify(t):!0}function l(n,i){var r,f;try{r=JSON.parse(i)}catch(e){return}r.table&&(f=vt(t.m_oElementCourant[t.sGetWLEXEC("JSEXEC_ELEMENTCOURANT_WRITETABLE")],u,r),f.ajouteAttrStyle(r.table))}function s(n,t){if(n.hasAttributes())for(var i=n.attributes.length-1;i>=0;i--)t.setAttribute(n.attributes[i].name,n.attributes[i].value)}function c(n){var f=0,i,t;for(u.find("tr").first().children("td").each(function(){f+=parseInt(this.getAttribute("colspan")||1)}),i=u[0].insertRow(r.parent().index()+(n?0:1)),t=0;t<f;++t)s(r.get(0),i.insertCell(t));return i}var u,r,e;if(!n[0].parentElement.wdSaisieRiche&&t.m_oOptions.bGestionTables&&(u=i.closest("table"),!u.find("[rowspan]").length)){r=i;u.addClass("wbSaisieRicheTableSelectionne");u.find("td").removeClass("wbSaisieRicheTdSelectionne");r.addClass("wbSaisieRicheTdSelectionne");e=nt(r);n.on("keydown.wb.saisieriche.barretable",function(n){var f,i,e,s,h,l,o;if(r&&r.length){if(f=!1,i=t.__oGetSelection(),f=n.ctrlKey&&n.key==="a")t.CreerRangeSelectionTexteSurBaliseCible(r[0]);else if(i.rangeCount>0&&(e=i.getRangeAt(0),$.contains(u[0],e.commonAncestorContainer))){function t(n){i.type==="Caret"?(e.selectNodeContents(n),e.collapse(!0)):e.setEndAfter(n)}(f=n.key==="Tab"&&!n.ctrlKey)?(s=!1,h=undefined,r[0]!=u.add(u.children("tbody")).children("tr").children("td").each(function(){if(s)return t(this),!1;if(this===r[0]){if(n.shiftKey)return t(h),!1;s=!0}h=this}).last().get(0)||n.shiftKey||(l=c(!1),t(l.firstElementChild))):(f=n.key==="ArrowDown"&&i.focusNode&&i.focusNode.parentElement&&i.focusNode.parentElement.nextElementSibling)?(o=r.index(),t(r[0].parentElement.nextElementSibling.children[o])):(f=n.key==="ArrowUp"&&i.focusNode&&i.focusNode.parentElement&&i.focusNode.parentElement.previousElementSibling)&&(o=r.index(),t(r[0].parentElement.previousElementSibling.children[o]))}f&&(n.stopPropagation(),n.preventDefault())}});t.m_oElementCourant={};t.m_oElementCourant[t.sGetWLEXEC("JSEXEC_ELEMENTCOURANT_READTABLE")]=function(){return f(u)};t.m_oElementCourant[t.sGetWLEXEC("JSEXEC_ELEMENTCOURANT_WRITETABLE")]=function(n){try{var i=typeof n=="object"?n:JSON.parse(n)}catch(r){return!1}return t.EmpileUndoRedo(u,()=>f(u,i))};h.children().each(function(){$(this).on("click.wb.saisieriche.barretable",function(i){if(r&&r.length){i.stopPropagation();i.preventDefault();n.trigger("trigger.wb.saisieriche.deselectionneTout");var e=b[$(this).index()];t.EmpileUndoRedo(u,()=>{var i=!1,a,h;switch(e.action){case"ROW.BEFORE":i=!0;case"ROW.AFTER":c(i);break;case"ROW.DELETE":h=r.parent().index();r=r.parent().siblings().first().children().eq(r.index());u[0].deleteRow(h);break;case"COLUMN.BEFORE":i=!0;case"COLUMN.AFTER":a=r.index()+(i?0:1);u.find("tr").each(function(){s(r.get(0),this.insertCell(a))});break;case"COLUMN.DELETE":h=r.index();r=r.next().add(r.siblings().first()).last();u.find("tr").each(function(){this.deleteCell(h)});break;case"WLEXEC":return(!o.WL||t.m_bModeWeb?l:o.WL.Execute)(e.param,f(u)),n.trigger("trigger.wb.saisieriche.deselectionneTout"),!1;default:return!1}return r.addClass("wbSaisieRicheTdSelectionne"),n.trigger("trigger.wb.saisieriche.deselectionneTout"),!0},(t,i)=>(r=i.find(".wbSaisieRicheTdSelectionne"),r.removeClass("wbSaisieRicheTdSelectionne"),!t)?(n.trigger("trigger.wb.saisieriche.deselectionneTout"),!1):(yt(r),!0))}})});ft(e,h,undefined,!0)}}function ii(i,r){var f,u,e;if(n[0].parentElement.wdSaisieRiche){if(f=n[0].parentElement.wdSaisieRiche.oGetElementByIdBarre(parent.document,"LNK"),f&&!clWDUtil.bEstDisplay(f,parent.document))return}else if(!t.m_oOptions.bGestionLiens){r.ctrlKey&&window.WL&&WL.Execute(t.sGetWLEXEC("WLEXEC_CLICLIEN"),i[0].href);return}i.addClass("wbSaisieRicheLienSelectionne");u=i;e=nt(i);l.children().each(function(){$(this).on("click.wb.saisieriche.barrelien",function(i){if(u&&u.length){i.stopPropagation();i.preventDefault();n.trigger("trigger.wb.saisieriche.deselectionneTout");var r=w[$(this).index()];r.fAction&&t.EmpileUndoRedo(u,()=>r.fAction(u),(t,i)=>{n.trigger("trigger.wb.saisieriche.deselectionneTout"),t&&setTimeout(function(){n.trigger("trigger.wb.saisieriche.selectionne",i)},100)})}})});ft(e,l)}function pt(n,t){t&&t[0]&&(["top","right","bottom","left"].forEach(function(t){var i="margin"+t[0].toUpperCase()+t.substr(1),u=n[i];r.css("border-"+t+"-width",u).css(i,-u)}),rt.css("marginTop",-n.marginTop).finish().fadeIn(),d.css("marginLeft",n.marginRight).finish().fadeIn(),g.css("marginLeft",-n.marginLeft).finish().fadeIn(),ut.css("marginTop",n.marginBottom).finish().fadeIn(),(t[0].style.width=="100%"||t[0].style.margin.indexOf("auto")>-1)&&(d.finish().fadeOut(),g.finish().fadeOut()))}function wt(t,i,r){n.find(".wbSaisieRicheWrapperSelection").length||(n.append(f),f.css({width:t.width,height:t.height,top:t.top,left:t.left,transform:t.transform,transformOrigin:t.transformOrigin}),r&&f.css({height:0}),pt(t,i))}function bt(n,t,i,r){wt(n,i,r);f.append(t)}function it(n,i){i&&i.effect&&i.effect("shake",{distance:5},250);t.sGetTraduction("HTML_TOOLBAR.DLG.ERR")&&alert(t.sGetTraduction("HTML_TOOLBAR.DLG.ERR"))}function ft(t,i,r,u){wt(t,r,u);f.append(i);var e={top:-t.marginTop,left:0,marginTop:"",marginLeft:t.width/2-i.width()/2,transform:t.transform.split("rad").map(function(n){return n.split("rotateZ(")[1]}).map(function(n){return n?"rotateZ("+-1*parseFloat(n)+"rad)":""}).join(" ")};t.top-t.marginTop<i.height()+5&&(e.top=t.height+i.height(),e.marginTop="calc(-1.5rem + 3px)");t.left+e.marginLeft<0?e.marginLeft=0:t.left+e.marginLeft+i.width()>n.width()&&(e.left=-i.width()+t.width,e.marginLeft=0);i.css(e)}function ri(e){function kt(n,i){var r,u;try{r=JSON.parse(i)}catch(f){return}r.img&&(u=vt(t.m_oElementCourant[t.sGetWLEXEC("JSEXEC_ELEMENTCOURANT_WRITEIMG")],h,r),u.ajouteAttrStyle(r.img))}function et(n,t){var i=t===undefined;return t||(t={id:WDSaisieAPI.uuidv4(),img:{}}),tt(t.img,n,i),i?JSON.stringify(t):!0}var ut,l;if(!n[0].parentElement.wdSaisieRiche||(ut=n[0].parentElement.wdSaisieRiche.oGetElementByIdBarre(parent.document,"IMG"),!ut||clWDUtil.bEstDisplay(ut,parent.document))){e.addClass("wbSaisieRicheImgSelectionne");t.CreerRangeSelectionTexteSurBaliseCible(e[0],!0);l=nt(e);l.transform=e[0].style.transform;l.transformOrigin=e[0].style.transformOrigin;var g=l.left,rt=l.top,h=e,a,w,v,ot,st,b,k,d,y,p,ct,lt,at=function(t){var i,r,e,u,f;i=t.screenX-ot;r=t.screenY-st;y=i*v[2]+b;p=r*v[3]+k;e=h.is("img")&&!t.shiftKey;e&&(Math.abs(i)>Math.abs(r)?(p=Math.round(y*d),y=Math.round(p/d)):(y=Math.round(p/d),p=Math.round(y*d)));a.css({width:y,height:p});u=v.startPos.x+i;f=v.startPos.y+r;u=u>0?u:0;f=f>0?f:0;w.css({left:u,top:f,display:"block"});w[0].innerHTML=Math.round(y)+" &times; "+Math.round(p);v[2]<0&&a[0].clientWidth<=y&&a.css("left",g+(b-y));v[3]<0&&a[0].clientHeight<=p&&a.css("top",rt+(k-p));i=n[0].scrollWidth-ct;r=n[0].scrollHeight-lt;i+r!==0&&w.css({left:u-i,top:f-r})},yt=function(){h.removeAttr("width").css("width",y);h.removeAttr("height").css("height",p);n.removeClass("wbSaisieRicheIframeBodyDragEnCours").css("cursor","");n.off("mousemove.wb.saisieriche.redimensionne",at);n.off("mouseup.wb.saisieriche.redimensionne",yt);a.remove();w.remove();setTimeout(function(){n.trigger("trigger.wb.saisieriche.selectionne",h)},1)},wt=function(t,i){v=t;ot=i.screenX;st=i.screenY;b=h.width();k=h.height();d=k/b;v.startPos={x:l.width*v[0]+g,y:l.height*v[1]+rt};ct=n[0].scrollWidth;lt=n[0].scrollHeight;a=h.clone(!0);a.addClass("wbSaisieRicheImgGhost");a[0].contentEditable=!1;a[0].unSelectabe=!0;a.css({left:g,top:rt,marginRight:0,marginBottom:0,marginTop:-parseInt(getComputedStyle(h[0]).borderTopWidth),marginLeft:-parseInt(getComputedStyle(h[0]).borderLeftWidth)});a.removeClass("wbSaisieRicheImgSelectionne");n.append(a);n.css("cursor",$(i.target).css("cursor")).addClass("wbSaisieRicheIframeBodyDragEnCours");n.on("mousemove.wb.saisieriche.redimensionne",at);n.on("mouseup.wb.saisieriche.redimensionne",yt);n.append(w=$('<div class="wbSaisieRicheImgBulle">'+Math.round(b)+" &times; "+Math.round(k)+"<\/div>"));w.css({left:g+b,top:rt+k})};i.not(".wbSaisieRicheTrackerMargeWrap").each(function(){$(this).one("mousedown.wb.saisieriche.redimensionne",function(t){if(t.stopPropagation(),t.preventDefault(),$(this).hasClass("wbSaisieRicheTrackerCoinShift")){var f=h.offset().left+l.width/2,e=h.offset().top+l.height/2,i=gt[t.target.id],o=Math.atan(l.height*i[1]/(l.width*i[0])),s=h[0].style.transform,r=function(){n.off("mousemove.wb.saisieriche.rotation",u);n.off("mouseup.wb.saisieriche.rotation",r);setTimeout(function(){n.trigger("trigger.wb.saisieriche.selectionne",h)},1)},u=function(n){var t=n.pageX-f,i=n.pageY-e,r=Math.atan(i/t);h[0].style.transform=s+" rotateZ("+(o+r)+"rad)"};n.on("mousemove.wb.saisieriche.rotation",u);n.on("mouseup.wb.saisieriche.rotation",r);return}wt(ht[t.target.id],t)})});r.children().each(function(){var u="margin",e="page",o=!1;switch(this.id){case"wbSaisieRicheTrackerMargeT":u+="Top";e+="Y";o=!0;break;case"wbSaisieRicheTrackerMargeR":u+="Right";e+="X";o=!1;break;case"wbSaisieRicheTrackerMargeB":u+="Bottom";e+="Y";o=!1;break;case"wbSaisieRicheTrackerMargeL":u+="Left";e+="X";o=!0}var c=undefined,s=$(),a=function(){n.off("mousemove.wb.saisieriche.margin",c);n.off("mouseup.wb.saisieriche.margin",a);h.css({marginTop:l.marginTop,marginRight:l.marginRight,marginBottom:l.marginBottom,marginLeft:l.marginLeft});s.remove();f.css("margin","");n.removeClass("wbSaisieRicheIframeBodyDragEnCours").css("cursor","");r.removeClass("wbSaisieRicheTrackerMargeMagnetismeT").removeClass("wbSaisieRicheTrackerMargeMagnetismeR").removeClass("wbSaisieRicheTrackerMargeMagnetismeB").removeClass("wbSaisieRicheTrackerMargeMagnetismeL");setTimeout(function(){n.trigger("trigger.wb.saisieriche.selectionne",h)},1)},v=$(this);v.one("click.wb.saisieriche.margin",function(n){n.stopPropagation();n.preventDefault()}).one("dblclick.wb.saisieriche.margin",function(n){n.stopPropagation();n.preventDefault();var r=n&&(n.ctrlKey||n.which==17),i=prompt(t.sGetTraduction("HTML_TOOLBAR.DLG.MRG")||"Margin ?",l[u]);i!==undefined&&(l[u]=parseFloat(i),r&&(l.marginTop=l.marginRight=l.marginBottom=l.marginLeft=l[u]),a())}).one("mousedown.wb.saisieriche.margin",function(t){t.stopPropagation();t.preventDefault();var w=t[e],b=!1,p=1,y={marginTop:l.marginTop,marginRight:l.marginRight,marginBottom:l.marginBottom,marginLeft:l.marginLeft},k={width:l.width};n.append(s=$('<div class="wbSaisieRicheImgBulle"><\/div>'));n.css("cursor",v.css("cursor")).addClass("wbSaisieRicheIframeBodyDragEnCours");majBulle=function(){var i=v.offset(),n,t;s[0].innerHTML=Math.round(l[u])+"&nbsp;px";n=i.left;t=i.top+s.height();n=n>0?n:0;t=t>0?t:0;s.css({left:n,top:t})};majBulle();s.hide().delay(150).fadeIn(150);c=function(n){var s,c,a;b||y[u]!=0||(p=1,o?n[e]>w&&(p=-1):n[e]<w&&(p=-1));var k=p*(o?-1:1),v=(n[e]-w)*k,t=10;Math.abs(v)>5&&(b=!0);l[u]=Math.max(0,y[u]+v);s=n&&(n.shiftKey||n.which==16);c=n&&(n.ctrlKey||n.which==17);!s&&Math.abs(l[u]-y[u])>t&&Math.abs(l[u])<t&&y[u]>t&&(l[u]=0);["Top","Right","Bottom","Left"].forEach(function(n){!c&&!s&&u.substr(6)!=n&&Math.abs(l[u]-y[u])>t&&Math.abs(l[u]-l["margin"+n])<t?(l[u]=l["margin"+n],r.addClass("wbSaisieRicheTrackerMargeMagnetisme"+n[0])):r.removeClass("wbSaisieRicheTrackerMargeMagnetisme"+n[0])});c&&(l.marginTop=l.marginBottom=l[u],h[0].style.width=="100%"||h[0].style.margin.indexOf("auto")>-1||(l.marginRight=l.marginLeft=l[u]));majBulle();pt(l,h);h.css({marginTop:l.marginTop,marginRight:l.marginRight,marginBottom:l.marginBottom,marginLeft:l.marginLeft});bt(l,i,h);a={marginTop:l.marginTop-y.marginTop,marginLeft:l.marginLeft-y.marginLeft};h[0].style.float=="right"&&(a.marginLeft=y.marginRight-l.marginRight);f.css(a)};n.on("mousemove.wb.saisieriche.margin",c);n.on("mouseup.wb.saisieriche.margin",a)})});bt(l,i,h);c.children().each(function(){var i=function(r){var f,ut,w,g,ft,y,b,k,tt,ot,c,rt,d,p;if(h&&h.length){if(r&&r.stopPropagation(),r&&r.preventDefault(),f=s[$(this).index()],f.action&&f.action=="MODIFIER_SRC")if(o.wbEditeurImageFactory)ut=o.wbEditeurImageFactory(function(t){if(t){$(h).one("load.wb.saisieriche.chargementApresEditeurImage",function(){f.height="auto";n.trigger("trigger.wb.saisieriche.selectionne",h)});h[0].src=t}},h[0].src),$(ut).hide().fadeIn().focus(),u.body.parentElement.wdSaisieRiche&&u.body.parentElement.wdSaisieRiche.RafBarre(undefined,!1);else{if(o.WL){(!o.WL||t.m_bModeWeb?kt:o.WL.Execute)(t.sGetWLEXEC("WLEXEC_EDITIMAGE"),et(h));n.trigger("trigger.wb.saisieriche.deselectionneTout");return}if(w=prompt(t.sGetTraduction("HTML_TOOLBAR.DLG.IMG")||"Image ?",h[0].src.indexOf("data")==0?"http://":h[0].src),!w)return;h[0].src=w;f.height="auto"}else if(f.action&&f.action=="MODIFIER_ALT"){if(w=prompt(t.sGetTraduction("HTML_TOOLBAR.DLG.ALT")||"Alt ?",h[0].alt||h[0].title),!w)return;h[0].alt=w;h[0].title=w}else{if(f.action&&f.action=="ROTATE_CLOCKWISE_COPY"){if(h[0].src.indexOf("data")!=0&&!confirm(t.sGetTraduction("HTML_TOOLBAR.DLG.CPY")||"Continue ?"))return;try{g=-Math.PI/2;h[0].style.width=h.width();h[0].style.height=h.height();var a={w:h.height(),h:h.width()},e=new Image,v=$("<canvas>");v.attr({width:a.w,height:a.h});c=v[0].getContext("2d");e.setAttribute("crossOrigin","anonymous");e.onload=function(){var r=v[0].width/2,u=v[0].height/2,t=e.width,i=e.height;c.translate(r,u);c.rotate(-g);c.scale(h.width()/t,h.height()/i);c.drawImage(e,-t/2,-i/2,t,i);c.rotate(g);c.translate(-r,-u);h[0].src=v[0].toDataURL();n.trigger("trigger.wb.saisieriche.deselectionneTout");h.css("opacity",0).animate({width:a.w,height:a.h,opacity:1},{easing:$.ui?"easeOutExpo":"swing",duration:250,done:function(){n.trigger("trigger.wb.saisieriche.selectionne",h);h.css("opacity","")}});h[0].style.transform="";l.width=a.w;l.height=a.h};e.onerror=function(n){return it(n,h)};e.src=h[0].src}catch(st){it(st,h);h[0].style.transform=""}return}if(f.action&&f.action=="ROTATE_CLOCKWISE")ft=h.attr("data-wbSaisieRicheImgRotate")||0,y=(parseInt(ft)+1)%4,h.attr("data-wbSaisieRicheImgRotate",y),b=parseFloat(h[0].style.width)||h.width(),k=parseFloat(h[0].style.height)||h.height(),y==1||y==3?(tt=k-b,ot=-tt,h.css("transition","150ms transform ease-out,150ms margin ease-out").css("width",b).css("height",k).css("transformOrigin","center center").css("margin","0 "+tt+"px "+ot+"px 0").css("transform","translateX("+(-b/2+k/2)+"px) translateY("+(b/2-k/2)+"px) rotateZ("+-(y*Math.PI/2)+"rad)")):(y==2||y==0)&&h.css("transition","150ms transform ease-out,150ms margin ease-out").css("width",b).css("height",k).css("transformOrigin","center center").css("margin","").css("transform","translateX(0px) translateY(0px) "+(y==0?"rotateZ("+-2*Math.PI+"rad)":"rotateZ("+-Math.PI+"rad)")),y==0?setTimeout(function(){h.css("transition","").css("transform","")},200):setTimeout(function(){h.css("transition","")},200);else{if(f.action&&f.action=="CROP_SRC"){if(h[0].src.indexOf("data")!=0&&!confirm(t.sGetTraduction("HTML_TOOLBAR.DLG.CPY")||"Continue ?"))return;if(h[0].style.transform!="")try{var ht=parseInt(h.attr("data-wbSaisieRicheImgRotate")||0)%2==1,g=h[0].style.transform.split("rad").map(function(n){return n.split("rotateZ(")[1]}).reduce(function(n){return n?-1*parseFloat(n):0}),a={w:h.width(),h:h.height()},e=new Image,v=$("<canvas>");v.attr({width:a.w,height:a.h});c=v[0].getContext("2d");e.setAttribute("crossOrigin","anonymous");e.onload=function(){var n=v[0].width/2,t=v[0].height/2,r=e.width,u=e.height;c.translate(n,t);c.rotate(-g);c.drawImage(e,-r/2,-u/2,r,u);c.rotate(g);c.translate(-n,-t);h[0].src=v[0].toDataURL();h[0].style.width=a.w+"px";h[0].style.height=a.h+"px";h[0].style.transform="";i();l=nt(h)};e.src=h[0].src;return}catch(st){h[0].style.transform="";i()}rt=$.extend({bgColor:"transparent",document:t.m_oDocument},getComputedStyle(h[0]));h.Jcrop(rt,function(){var t=this;t.setSelect([0,0,l.width,l.height]);n.trigger("trigger.wb.saisieriche.deselectionneTout");n.on("keyup.wb.saisieriche.crop click.wb.saisieriche.crop",function(i){function o(){t.destroy();h[0].style.display=rt.display;setTimeout(function(){n.trigger("trigger.wb.saisieriche.selectionne",h)},100)}var u,s;if(i.type=="keyup"?i.which==13?u=!0:i.which==27&&(u=!1):clWDUtil.bEstFils(i.target,n.find(".jcrop-holder").get(0))||(u=!0),u!==undefined){if(n.off("keyup.wb.saisieriche.crop click.wb.saisieriche.crop"),!u){t.destroy();return}try{var r=t.tellSelect(),f=new Image,e=$("<canvas>");e.attr({width:r.w,height:r.h});s=e[0].getContext("2d");f.setAttribute("crossOrigin","anonymous");f.onload=function(){s.drawImage(f,this.width*r.x/l.width,this.height*r.y/l.height,this.width*r.w/l.width,this.height*r.h/l.height,0,0,r.w,r.h);h[0].src=e[0].toDataURL();h[0].style.width=r.w+"px";h[0].style.height=r.h+"px"};f.onerror=function(n){return it(n,h)};f.src=h[0].src;o()}catch(c){it(c,h);o()}}})});n.trigger("trigger.wb.saisieriche.deselectionneTout");return}f.style&&(d=$.extend({},f.style),p={marginLeft:h[0].style.marginLeft,marginTop:h[0].style.marginTop,marginRight:h[0].style.marginRight,marginBottom:h[0].style.marginBottom},p.marginLeft=="auto"&&(p.marginLeft=0),p.marginRight=="auto"&&(p.marginRight=0),d.width?d.height="auto":(d.width=h[0].style.width=="100%"?l.width/2:l.width,d.height=h[0].style.width=="100%"?"auto":l.height),h.css(d),h[0].style.marginTop=p.marginTop,h[0].style.marginBottom=p.marginBottom,h[0].style.width=="100%"||h[0].style.margin.indexOf("auto")>-1||(h[0].style.marginLeft=p.marginLeft,h[0].style.marginRight=p.marginRight))}}n.trigger("trigger.wb.saisieriche.selectionne",h)}}.bind(this);$(this).on("click.wb.saisieriche.barreimg",i)});ft(l,c,h);t.m_oElementCourant={};t.m_oElementCourant[t.sGetWLEXEC("JSEXEC_ELEMENTCOURANT_READIMG")]=function(){return et(h)};t.m_oElementCourant[t.sGetWLEXEC("JSEXEC_ELEMENTCOURANT_WRITEIMG")]=function(n){try{var i=typeof n=="object"?n:JSON.parse(n)}catch(r){return!1}return t.EmpileUndoRedo(h,()=>et(h,i))}}}function ui(n,t){var u,i,r,f;if(n.dataTransfer){for(u=0;n.dataTransfer.files&&u<n.dataTransfer.files.length;++u)t(n.dataTransfer.files[u],n.dataTransfer.files.length);return}for(n.clipboardData==!1&&typeof t=="function"&&t(undefined),i=n.clipboardData.items,i==undefined&&typeof t=="function"&&t(undefined),r=0;r<i.length;r++)i[r].type.indexOf("image")!=-1&&(f=i[r].getAsFile(),typeof t=="function"&&t(f,i.length))}var e,et,ot,st,r,rt,d,ut,g,p,a,ct,w,v,lt,h,b,y,at,k;if(this.m_oOptions&&(this.m_oOptions.bGestionImages||this.m_oOptions.bGestionTables||this.m_oOptions.bGestionLiens)){this.m_oDocument.documentElement.setAttribute("class",(this.m_oDocument.documentElement.getAttribute("class")||"")+" wbSaisieRicheIframeHtml");e=this.m_oDocument.body.getAttribute("class")||"";e&&(e+=" ");e+="wbSaisieRicheIframeBody";this.m_oOptions.bGestionImages&&(e+=" wbSaisieRicheIframeBodyGestionImage");this.m_oOptions.bGestionTables&&(e+=" wbSaisieRicheIframeBodyGestionTable");this.m_oOptions.bGestionLiens&&(e+=" wbSaisieRicheIframeBodyGestionLien");this.m_oDocument.body.setAttribute("class",e);this.m_oOptions.bGestionImages&&this.__AjouteJCrop();var u=this.m_oDocument,o=this.m_oWindowPrincipale,n=$(u.body),t=this,kt=!1,i=$(),dt=$('<div contenteditable="false" id="wbSaisieRicheTrackerCoinNW"  class="wbSaisieRicheTrackerCoin" unselectable="true"><\/div>');i=i.add(dt);et=$('<div contenteditable="false" id="wbSaisieRicheTrackerCoinSW"  class="wbSaisieRicheTrackerCoin" unselectable="true"><\/div>');i=i.add(et);ot=$('<div contenteditable="false" id="wbSaisieRicheTrackerCoinNE"  class="wbSaisieRicheTrackerCoin" unselectable="true"><\/div>');i=i.add(ot);st=$('<div contenteditable="false" id="wbSaisieRicheTrackerCoinSE"  class="wbSaisieRicheTrackerCoin" unselectable="true"><\/div>');i=i.add(st);var f=$('<div contenteditable="false" id="wbSaisieRicheWrapperSelection" class="wbSaisieRicheWrapperSelection" unselectable="true"><\/div>'),ht={wbSaisieRicheTrackerCoinNW:[0,0,-1,-1],wbSaisieRicheTrackerCoinNE:[1,0,1,-1],wbSaisieRicheTrackerCoinSE:[1,1,1,1],wbSaisieRicheTrackerCoinSW:[0,1,-1,1]},gt={wbSaisieRicheTrackerCoinNW:[-1,1],wbSaisieRicheTrackerCoinNE:[1,1],wbSaisieRicheTrackerCoinSE:[1,-1],wbSaisieRicheTrackerCoinSW:[-1,-1]};i.each(function(){ht[this.id].elem=$(this)});r=$('<div contenteditable="false" id="wbSaisieRicheTrackerMargeWrap" class="wbSaisieRicheTrackerMargeWrap" unselectable="true"><\/div>');rt=$('<div contenteditable="false" title="'+t.sGetTraduction("HTML_TOOLBAR.DLG.DBL")+'" id="wbSaisieRicheTrackerMargeT"  class="wbSaisieRicheTrackerMarge" unselectable="true"><\/div>');r.append(rt);d=$('<div contenteditable="false" title="'+t.sGetTraduction("HTML_TOOLBAR.DLG.DBL")+'" id="wbSaisieRicheTrackerMargeR"  class="wbSaisieRicheTrackerMarge" unselectable="true"><\/div>');r.append(d);ut=$('<div contenteditable="false" title="'+t.sGetTraduction("HTML_TOOLBAR.DLG.DBL")+'" id="wbSaisieRicheTrackerMargeB"  class="wbSaisieRicheTrackerMarge" unselectable="true"><\/div>');r.append(ut);g=$('<div contenteditable="false" title="'+t.sGetTraduction("HTML_TOOLBAR.DLG.DBL")+'" id="wbSaisieRicheTrackerMargeL"  class="wbSaisieRicheTrackerMarge" unselectable="true"><\/div>');r.append(g);i=i.add(r);var c=$('<ul id="wbSaisieRicheBarreImg" class="wbSaisieRicheBarreImg wbBarreOutilsMiniBarreUl wbSaisieRicheBarre" unselectable="true" contenteditable="false"><\/ul>'),l=$('<ul id="wbSaisieRicheBarreLien" class="wbSaisieRicheBarreLien wbBarreOutilsMiniBarreUl wbSaisieRicheBarre" unselectable="true" contenteditable="false"><\/ul>'),s=[{sLibelle:t.sGetTraduction("HTML_TOOLBAR.HAB",0),nIndiceYDansPlanche:28,style:{maxWidth:"100%",width:"",float:"none",display:"inline",margin:"0"}},{sLibelle:t.sGetTraduction("HTML_TOOLBAR.HAB",1),nIndiceYDansPlanche:30,style:{maxWidth:"100%",width:"",float:"left",display:"inline",margin:"0"}},{sLibelle:t.sGetTraduction("HTML_TOOLBAR.HAB",2),nIndiceYDansPlanche:29,style:{maxWidth:"100%",width:"",float:"right",display:"inline",margin:"0"}},{sLibelle:t.sGetTraduction("HTML_TOOLBAR.HAB",3),nIndiceYDansPlanche:31,style:{maxWidth:"100%",width:"",float:"none",display:"block",margin:"0 auto"}},{sLibelle:t.sGetTraduction("HTML_TOOLBAR.HAB",4),nIndiceYDansPlanche:32,style:{maxWidth:"100%",width:"100%",float:"none",display:"block",margin:"0"}}];for($.Jcrop&&s.push({sLibelle:t.sGetTraduction("HTML_TOOLBAR.HAB",6),nIndiceYDansPlanche:40,action:"CROP_SRC"}),s.push({sLibelle:t.sGetTraduction("HTML_TOOLBAR.HAB",7),nIndiceYDansPlanche:41,action:"ROTATE_CLOCKWISE_COPY"}),s.push({sLibelle:t.sGetTraduction("HTML_TOOLBAR.HAB",8),nIndiceYDansPlanche:35,action:"MODIFIER_ALT"}),s.push({sLibelle:t.sGetTraduction("HTML_TOOLBAR.HAB",5),nIndiceYDansPlanche:25,action:"MODIFIER_SRC"}),p="wbBarreOutilsImgPlanche"+(bIEAvec11||bEdge?"":" wbBarreOutilsImgPlancheSVG"),this.m_bModeWeb||(p="wbBarreOutilsImgPlanche wbBarreOutilsImgPlancheSVGWDL"),a=0;a<s.length;++a)ct=$('<li class="wbSaisieRicheBarreImgLi wbBarreOutilsMiniBarreLi" id="wbSaisieRicheBarreImgLi'+a+'"><i class="wbBarreOutilsImgPlancheWrap"><i title="'+s[a].sLibelle+'" style="cursor:pointer;transform:translateY(calc(-100% * '+s[a].nIndiceYDansPlanche+" / "+WDSaisieAPI.PLANCHE_NB_IMAGES+'));" class="'+p+' wbplanche wbPlanche5Etat1Anim"><\/i><\/li>'),c.append(ct);for(w=[{sLibelle:t.sGetTraduction("HTML_TOOLBAR.LNK",0),nIndiceYDansPlanche:37,fAction:function(n){o.open(n.attr("href"),"_blank")}},{sLibelle:t.sGetTraduction("HTML_TOOLBAR.LNK",1),nIndiceYDansPlanche:24,fAction:function(n){var i=prompt(t.sGetTraduction("HTML_TOOLBAR.DLG.LNK")||"URL ?",n.attr("href"));if(i)return n.attr("href",i),!0}},{sLibelle:t.sGetTraduction("HTML_TOOLBAR.LNK",2),nIndiceYDansPlanche:38,fAction:function(n){return n.replaceWith("<span>"+n.html()+"<\/span>"),!1}},],v=0;v<w.length;++v)lt=$('<li class="wbSaisieRicheBarreLienLi wbBarreOutilsMiniBarreLi" id="wbSaisieRicheBarreLienLi'+v+'"><i class="wbBarreOutilsImgPlancheWrap"><i title="'+w[v].sLibelle+'" style="cursor:pointer;transform:translateY(calc(-100% * '+w[v].nIndiceYDansPlanche+" / "+WDSaisieAPI.PLANCHE_NB_IMAGES+'));" class="'+p+' wbplanche wbPlanche5Etat1Anim"><\/i><\/li>'),l.append(lt);for(h=$('<ul id="wbSaisieRicheBarreTable" class="wbSaisieRicheBarreTable wbBarreOutilsMiniBarreUl wbSaisieRicheBarre" unselectable="true" contenteditable="false"><\/ul>'),b=[{sLibelle:t.sGetTraduction("HTML_TOOLBAR.TABLE.ROW.BEFORE"),nIndiceYDansPlanche:42,action:"ROW.BEFORE"},{sLibelle:t.sGetTraduction("HTML_TOOLBAR.TABLE.ROW.AFTER"),nIndiceYDansPlanche:43,action:"ROW.AFTER"},{sLibelle:t.sGetTraduction("HTML_TOOLBAR.TABLE.ROW.DELETE"),nIndiceYDansPlanche:44,action:"ROW.DELETE"},{sLibelle:t.sGetTraduction("HTML_TOOLBAR.TABLE.COLUMN.BEFORE"),nIndiceYDansPlanche:45,action:"COLUMN.BEFORE"},{sLibelle:t.sGetTraduction("HTML_TOOLBAR.TABLE.COLUMN.AFTER"),nIndiceYDansPlanche:46,action:"COLUMN.AFTER"},{sLibelle:t.sGetTraduction("HTML_TOOLBAR.TABLE.COLUMN.DELETE"),nIndiceYDansPlanche:47,action:"COLUMN.DELETE"},{sLibelle:t.sGetTraduction("HTML_TOOLBAR.TABLE.CELL.PROP"),nIndiceYDansPlanche:51,action:"WLEXEC",param:t.sGetWLEXEC("WLEXEC_EDITTABLECEL")},{sLibelle:t.sGetTraduction("HTML_TOOLBAR.TABLE.PROP"),nIndiceYDansPlanche:48,action:"WLEXEC",param:t.sGetWLEXEC("WLEXEC_EDITTABLE")}],y=0;y<b.length;++y)at=$('<li class="wbSaisieRicheBarreTableLi wbBarreOutilsMiniBarreLi" id="wbSaisieRicheBarreTableLi'+y+'"><i class="wbBarreOutilsImgPlancheWrap"><i title="'+b[y].sLibelle+'" style="cursor:pointer;transform:translateY(calc(-100% * '+b[y].nIndiceYDansPlanche+" / "+WDSaisieAPI.PLANCHE_NB_IMAGES+'));" class="'+p+' wbplanche wbPlanche5Etat1Anim"><\/i><\/li>'),h.append(at);k=["width","height","align","bgcolor","border","colspan","rowspan","valign","cellpadding","cellspacing","alt","hspace","vspace","crossorigin","decoding","ismap","loading","sizes","src","srcset","usemap"];$(window).on("resize.wb.saisieriche",function(){n.trigger("trigger.wb.saisieriche.deselectionneTout")});n.on("trigger.wb.saisieriche.deselectionneTout",function(){n.find(".wbSaisieRicheImgSelectionne").each(function(){return $(this).removeClass("wbSaisieRicheImgSelectionne"),i.removeClass("wbSaisieRicheTrackerCoinShift"),r.children().off(),i=i.off().detach(),c.children().off(),c=c.detach(),!1});n.find(".wbSaisieRicheLienSelectionne").each(function(){return $(this).removeClass("wbSaisieRicheLienSelectionne"),l.children().off(),l=l.detach(),!1});n.find(".wbSaisieRicheTableSelectionne").each(function(){return $(this).removeClass("wbSaisieRicheTableSelectionne").find("td").removeClass("wbSaisieRicheTdSelectionne"),h.children().off(),h=h.detach(),n.off("keydown.wb.saisieriche.barretable"),!1});n.find(".wbSaisieRicheWrapperSelection").each(function(){return f=f.off().detach(),!1})}).on("blur.wb.saisieriche.quitte",function(){n.trigger("trigger.wb.saisieriche.deselectionneTout")}).on("keydown.wb.saisieriche.selectionne",function(t){if(n.find(".wbSaisieRicheImgSelectionne").length&&!n.find(".wbSaisieRicheImgGhost").length){var u=t&&(t.shiftKey||t.which==16),f=t&&(t.ctrlKey||t.which==17),r=!1;u&&(r=!0,kt&&i.addClass("wbSaisieRicheTrackerCoinShift"));f&&(r=!0);r||(i.removeClass("wbSaisieRicheTrackerCoinShift"),n.trigger("trigger.wb.saisieriche.deselectionneTout"))}}).on("click.wb.saisieriche.selectionne keyup.wb.saisieriche.selectionne trigger.wb.saisieriche.selectionne input.wb.saisieriche.selectionne DOMCharacterDataModified.wb.saisieriche.selectionne",function(i,r){if(!i||i.type!=="input"||!t.m_bUndoRedoEnCours){var u=$(r||i.target),o=u,e=t.__oGetSelection();if(e&&e.focusNode)if(e.rangeCount===0)o=e.focusNode.nodeType===Node.ELEMENT_NODE?$(e.focusNode):$(e.focusNode).parent();else{var f=e.getRangeAt(0),s=[],l=f.startContainer.nodeType===Node.ELEMENT_NODE?f.startContainer:f.startContainer.parentElement,a=f.endContainer.nodeType===Node.ELEMENT_NODE?f.endContainer:f.endContainer.parentElement,h=$(l).add(a);$(f.commonAncestorContainer).find("td").add(f.commonAncestorContainer).filter("td").each(function(){if(this===h[0])s.push(this);else{if(this===h[1])return s.push(this),!1;s.length&&s.push(this)}});o=h.add($(s))}var c=o.parents().add(o).add(u).closest("td,th"),v=i&&(i.shiftKey||i.which==16),y=i&&(i.ctrlKey||i.which==17);if((i.type=="keyup"&&(v||y)||n.trigger("trigger.wb.saisieriche.deselectionneTout"),u&&u.length)&&u[0].parentElement)if(u.is("img"))ri(u,i);else if(u.is("a[href]"))ii(u,i);else if(o.length===1&&c.length)yt(c.last(),i);else return}}).on("dragover.wb.saisieriche.image",function(t){var i=t.originalEvent?t.originalEvent:t,r=i.dataTransfer&&i.dataTransfer.items?i.dataTransfer.items[0]:undefined;r&&r.type&&r.type.match("image.*")&&(n.addClass("wbSaisieRicheIframeBodyDragImg"),t.stopPropagation(),t.preventDefault())}).on("dragend.wb.saisieriche.image mouseup.wb.saisieriche.image mouseleave.wb.saisieriche.image",function(){n.removeClass("wbSaisieRicheIframeBodyDragImg")}).on("drop.wb.saisieriche.image paste.wb.saisieriche.image",function(i){n.removeClass("wbSaisieRicheIframeBodyDragImg");var r=i.originalEvent?i.originalEvent:i,f=r.clientX,e=r.clientY;ui(r,function(i,o){if(i&&i.type&&i.type.match("image.*")){r.stopPropagation();r.preventDefault();var h=new FileReader,s;h.onload=function(i){var l=i.target.result,r=u.createElement("img"),c,h;r.setAttribute("crossOrigin","anonymous");r.src=l;r.style.width=Math.min(n.width()*.8/o,200)+"px";r.style.margin="24px";f===undefined||e===undefined?(c=t.__oGetSelection(),s=c.getRangeAt(0),s?s.insertNode(r):u.body.appendChild(r)):u.caretPositionFromPoint?(h=u.caretPositionFromPoint(f,e),s=u.createRange(),s.setStart(h.offsetNode,h.offset),s.collapse(),s.insertNode(r)):u.caretRangeFromPoint&&(s=u.caretRangeFromPoint(f,e),s.insertNode(r));setTimeout(function(){n.trigger("trigger.wb.saisieriche.selectionne",$(r))},100)};h.readAsDataURL(i)}})})}};WDSaisieAPI.prototype.__AjouteJCrop=function(){(function(n){var t=window.document;n.Jcrop=function(i,r){function c(n){return Math.round(n)+"px"}function et(n){return u.baseClass+"-"+n}function ki(){return n.fx.step.hasOwnProperty("backgroundColor")}function ot(t){var i=n(t).offset();return[i.left,i.top]}function tt(n){return[n.pageX-k[0],n.pageY-k[1]]}function ui(t){typeof t!="object"&&(t={});u=n.extend(u,t);n.each(["onChange","onSelect","onRelease","onDblClick"],function(n,t){typeof u[t]!="function"&&(u[t]=function(){})})}function fi(n,t,i){if(k=ot(o),w.setCursor(n==="move"?n:n+"-resize"),n==="move")return w.activateHandlers(gi(t),wt,i);var u=h.getFixed(),r=ei(n),f=h.getCorner(ei(r));h.setPressed(h.getCorner(r));h.setCurrent(f);w.activateHandlers(di(n,u),wt,i)}function di(n,t){return function(i){if(u.aspectRatio)switch(n){case"e":i[1]=t.y+1;break;case"w":i[1]=t.y+1;break;case"n":i[0]=t.x+1;break;case"s":i[0]=t.x+1}else switch(n){case"e":i[1]=t.y2;break;case"w":i[1]=t.y2;break;case"n":i[0]=t.x2;break;case"s":i[0]=t.x2}h.setCurrent(i);f.update()}}function gi(n){var t=n;return dt.watchKeys(),function(n){h.moveOffset([n[0]-t[0],n[1]-t[1]]);t=n;f.update()}}function ei(n){switch(n){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function oi(n){return function(t){return u.disabled?!1:n==="move"&&!u.allowMove?!1:(k=ot(o),ft=!0,fi(n,tt(t)),t.stopPropagation(),t.preventDefault(),!1)}}function si(n,t,i){var r=n.width(),u=n.height();r>t&&t>0&&(r=t,u=t/n.width()*n.height());u>i&&i>0&&(u=i,r=i/n.height()*n.width());a=n.width()/r;v=n.height()/u;n.width(r).height(u)}function st(n){return{x:n.x*a,y:n.y*v,x2:n.x2*a,y2:n.y2*v,w:n.w*a,h:n.h*v}}function wt(){var n=h.getFixed();n.w>u.minSelect[0]&&n.h>u.minSelect[1]?(f.enableHandles(),f.done()):f.release();w.setCursor(u.allowSelect?"crosshair":"default")}function hi(n){if(u.disabled||!u.allowSelect)return!1;ft=!0;k=ot(o);f.disableHandles();w.setCursor("crosshair");var t=tt(n);return h.setPressed(t),f.update(),w.activateHandlers(nr,wt,n.type.substring(0,5)==="touch"),dt.watchKeys(),n.stopPropagation(),n.preventDefault(),!1}function nr(n){h.setCurrent(n);f.update()}function ci(){var t=n("<div><\/div>").addClass(et("tracker"));return ii&&t.css({opacity:0,backgroundColor:"white"}),t}function tr(n){b.removeClass().addClass(et("holder")).addClass(n)}function ir(n,t){function b(){window.setTimeout(k,d)}var c=n[0]/a,l=n[1]/v,p=n[2]/a,w=n[3]/v,k;if(!kt){var o=h.flipCoords(c,l,p,w),s=h.getFixed(),e=[s.x,s.y,s.x2,s.y2],i=e,d=u.animationDelay,g=o[0]-e[0],nt=o[1]-e[1],tt=o[2]-e[2],it=o[3]-e[3],r=0,rt=u.swingSpeed;c=i[0];l=i[1];p=i[2];w=i[3];f.animMode(!0);k=function(){return function(){r+=(100-r)/rt;i[0]=Math.round(c+r/100*g);i[1]=Math.round(l+r/100*nt);i[2]=Math.round(p+r/100*tt);i[3]=Math.round(w+r/100*it);r>=99.8&&(r=100);r<100?(pi(i),b()):(f.done(),f.animMode(!1),typeof t=="function"&&t.call(y))}}();b()}}function yi(n){pi([n[0]/a,n[1]/v,n[2]/a,n[3]/v]);u.onSelect.call(y,st(h.getFixed()));f.enableHandles()}function pi(n){h.setPressed([n[0],n[1]]);h.setCurrent([n[2],n[3]]);f.update()}function rr(){return st(h.getFixed())}function ur(){return h.getFixed()}function fr(n){ui(n);ni()}function wi(){u.disabled=!0;f.disableHandles();f.setCursor("default");w.setCursor("default")}function bi(){u.disabled=!1;ni()}function er(){f.done();w.activateHandlers(null,null)}function or(){b.remove();l.show();l.css("visibility","visible");n(i).removeData("Jcrop")}function sr(n,t){f.release();wi();var i=new Image;i.onload=function(){var r=i.width,f=i.height,h=u.boxWidth,c=u.boxHeight;o.width(r).height(f);o.attr("src",n);d.attr("src",n);si(o,h,c);s=o.width();e=o.height();d.width(s).height(e);g.width(s+ut*2).height(e+ut*2);b.width(s).height(e);nt.resize(s,e);bi();typeof t=="function"&&t.call(y)};i.src=n}function gt(n,t,i){var r=t||u.bgColor;u.bgFade&&ki()&&u.fadeTime&&!i?n.animate({backgroundColor:r},{queue:!1,duration:u.fadeTime}):n.css("backgroundColor",r)}function ni(n){u.allowResize?n?f.enableOnly():f.enableHandles():f.disableHandles();w.setCursor(u.allowSelect?"crosshair":"default");f.setCursor(u.allowMove?"move":"default");u.hasOwnProperty("trueSize")&&(a=u.trueSize[0]/s,v=u.trueSize[1]/e);u.hasOwnProperty("setSelect")&&(yi(u.setSelect),f.done(),delete u.setSelect);nt.refresh();u.bgColor!=ai&&(gt(u.shade?nt.getShades():b,u.shade?u.shadeColor||u.bgColor:u.bgColor),ai=u.bgColor);ht!=u.bgOpacity&&(ht=u.bgOpacity,u.shade?nt.refresh():f.setBgOpacity(ht));ct=u.maxSize[0]||0;lt=u.maxSize[1]||0;at=u.minSize[0]||0;vt=u.minSize[1]||0;u.hasOwnProperty("outerImage")&&(o.attr("src",u.outerImage),delete u.outerImage);f.refresh()}var u=n.extend({},n.Jcrop.defaults),k,ti=navigator.userAgent.toLowerCase(),ii=/msie/.test(ti),ri=/msie [1-6]\./.test(ti),yt,o,y;u.document&&(t=u.document);typeof i!="object"&&(i=n(i)[0]);typeof r!="object"&&(r={});ui(r);var bt={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},l=n(i),li=!0;i.tagName=="IMG"?(l[0].width!=0&&l[0].height!=0?(l.width(l[0].width),l.height(l[0].height)):(yt=new Image,yt.src=l[0].src,l.width(yt.width),l.height(yt.height)),o=l.clone().removeAttr("id").css(bt).show(),o.width(l.width()),o.height(l.height()),l.after(o).hide()):(o=l.css(bt).show(),li=!1,u.shade===null&&(u.shade=!0));si(o,u.boxWidth,u.boxHeight);var s=o.width(),e=o.height(),b=n("<div />").width(s).height(e).addClass(et("holder")).css({position:"relative",backgroundColor:u.backgroundColor||u.bgColor,verticalAlign:u.verticalAlign,float:u.float,margin:u.margin,display:u.display&&u.display=="inline"?"inline-block":u.display}).insertAfter(l).append(o);u.addClass&&b.addClass(u.addClass);var d=n("<div />"),pt=n("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),it=n("<div />").width("100%").height("100%").css("zIndex",320),rt=n("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var n=h.getFixed();u.onDblClick.call(y,n)}).insertBefore(o).append(pt,it);li&&(d=n("<img />").attr("src",o.attr("src")).css(bt).width(s).height(e),pt.append(d));ri&&rt.css({overflowY:"hidden"});var ut=u.boundary,g=ci().width(s+ut*2).height(e+ut*2).css({position:"absolute",top:c(-ut),left:c(-ut),zIndex:290}).mousedown(hi),ai=u.bgColor,ht=u.bgOpacity,ct,lt,at,vt,a,v,ft,kt,vi;k=ot(o);var p=function(){function n(){var r={},f=["touchstart","touchmove","touchend"],e=t.createElement("div"),i,n,u;try{for(i=0;i<f.length;i++)n=f[i],n="on"+n,u=n in e,u||(e.setAttribute(n,"return;"),u=typeof e[n]=="function"),r[f[i]]=u;return r.touchstart&&r.touchend&&r.touchmove}catch(o){return!1}}function i(){return u.touchSupport===!0||u.touchSupport===!1?u.touchSupport:n()}return{createDragger:function(n){return function(t){return u.disabled?!1:n==="move"&&!u.allowMove?!1:(k=ot(o),ft=!0,fi(n,tt(p.cfilter(t)),!0),t.stopPropagation(),t.preventDefault(),!1)}},newSelection:function(n){return hi(p.cfilter(n))},cfilter:function(n){return n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,n},isSupported:n,support:i()}}(),h=function(){function p(u){u=l(u);r=n=u[0];i=t=u[1]}function w(n){n=l(n);o=n[0]-r;h=n[1]-i;r=n[0];i=n[1]}function b(){return[o,h]}function k(u){var f=u[0],o=u[1];0>n+f&&(f-=f+n);0>t+o&&(o-=o+t);e<i+o&&(o+=e-(i+o));s<r+f&&(f+=s-(r+f));n+=f;r+=f;t+=o;i+=o}function d(n){var t=c();switch(n){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function c(){if(!u.aspectRatio)return g();var c=u.aspectRatio,b=u.minSize[0]/a,w=u.maxSize[0]/a,nt=u.maxSize[1]/v,k=r-n,d=i-t,tt=Math.abs(k),it=Math.abs(d),rt=tt/it,o,h,l,p;return w===0&&(w=s*10),nt===0&&(nt=e*10),rt<c?(h=i,l=it*c,o=k<0?n-l:l+n,o<0?(o=0,p=Math.abs((o-n)/c),h=d<0?t-p:p+t):o>s&&(o=s,p=Math.abs((o-n)/c),h=d<0?t-p:p+t)):(o=r,p=tt/c,h=d<0?t-p:t+p,h<0?(h=0,l=Math.abs((h-t)*c),o=k<0?n-l:l+n):h>e&&(h=e,l=Math.abs(h-t)*c,o=k<0?n-l:l+n)),o>n?(o-n<b?o=n+b:o-n>w&&(o=n+w),h=h>t?t+(o-n)/c:t-(o-n)/c):o<n&&(n-o<b?o=n-b:n-o>w&&(o=n-w),h=h>t?t+(n-o)/c:t-(n-o)/c),o<0?(n-=o,o=0):o>s&&(n-=o-s,o=s),h<0?(t-=h,h=0):h>e&&(t-=h-e,h=e),y(f(n,t,o,h))}function l(n){return n[0]<0&&(n[0]=0),n[1]<0&&(n[1]=0),n[0]>s&&(n[0]=s),n[1]>e&&(n[1]=e),[Math.round(n[0]),Math.round(n[1])]}function f(n,t,i,r){var u=n,f=i,e=t,o=r;return i<n&&(u=i,f=n),r<t&&(e=r,o=t),[u,e,f,o]}function g(){var o=r-n,h=i-t,u;return ct&&Math.abs(o)>ct&&(r=o>0?n+ct:n-ct),lt&&Math.abs(h)>lt&&(i=h>0?t+lt:t-lt),vt/v&&Math.abs(h)<vt/v&&(i=h>0?t+vt/v:t-vt/v),at/a&&Math.abs(o)<at/a&&(r=o>0?n+at/a:n-at/a),n<0&&(r-=n,n-=n),t<0&&(i-=t,t-=t),r<0&&(n-=r,r-=r),i<0&&(t-=i,i-=i),r>s&&(u=r-s,n-=u,r-=u),i>e&&(u=i-e,t-=u,i-=u),n>s&&(u=n-e,i-=u,t-=u),t>e&&(u=t-e,i-=u,t-=u),y(f(n,t,r,i))}function y(n){return{x:n[0],y:n[1],x2:n[2],y2:n[3],w:n[2]-n[0],h:n[3]-n[1]}}var n=0,t=0,r=0,i=0,o,h;return{flipCoords:f,setPressed:p,setCurrent:w,getOffset:b,moveOffset:k,getCorner:d,getFixed:c}}(),nt=function(){function nt(n,t){i.left.css({height:c(t)});i.right.css({height:c(t)})}function v(){return y(h.getFixed())}function y(n){i.top.css({left:c(n.x),width:c(n.w),height:c(n.y)});i.bottom.css({top:c(n.y2),left:c(n.x),width:c(n.w),height:c(e-n.y2)});i.right.css({left:c(n.x2),width:c(s-n.x2)});i.left.css({width:c(n.x)})}function l(){return n("<div />").css({position:"absolute",backgroundColor:u.shadeColor||u.bgColor}).appendTo(t)}function p(){r||(r=!0,t.insertBefore(o),v(),f.setBgOpacity(1,0,1),d.hide(),w(u.shadeColor||u.bgColor,1),f.isAwake()?a(u.bgOpacity,1):a(1,1))}function w(n,t){gt(g(),n,t)}function k(){r&&(t.remove(),d.show(),r=!1,f.isAwake()?f.setBgOpacity(u.bgOpacity,1,1):(f.setBgOpacity(1,1,1),f.disableHandles()),gt(b,0,1))}function a(n,i){r&&(u.bgFade&&!i?t.animate({opacity:1-n},{queue:!1,duration:u.fadeTime}):t.css({opacity:1-n}))}function tt(){u.shade?p():k();f.isAwake()&&a(u.bgOpacity)}function g(){return t.children()}var r=!1,t=n("<div />").css({position:"absolute",zIndex:240,opacity:0}),i={top:l(),left:l().height(e),right:l().height(e),bottom:l()};return{update:v,updateRaw:y,getShades:g,setBgColor:w,enable:p,disable:k,resize:nt,refresh:tt,opacity:a}}(),f=function(){function ot(t){var i=n("<div />").css({position:"absolute",opacity:u.borderOpacity}).addClass(et(t));return pt.append(i),i}function a(t,i){var r=n("<div />").mousedown(oi(t)).css({cursor:t+"-resize",position:"absolute",zIndex:i}).addClass("ord-"+t);return p.support&&r.bind("touchstart.jcrop",p.createDragger(t)),it.append(r),r}function ct(n){var t=u.handleSize,i=a(n,l++).css({opacity:u.handleOpacity}).addClass(et("handle"));return t&&i.width(t).height(t),i}function lt(n){return a(n,l++).addClass("jcrop-dragbar")}function at(n){for(var t=0;t<n.length;t++)ft[n[t]]=lt(n[t])}function vt(n){for(var t,i=0;i<n.length;i++){switch(n[i]){case"n":t="hline";break;case"s":t="hline bottom";break;case"e":t="vline right";break;case"w":t="vline"}tt[n[i]]=ot(t)}}function yt(n){for(var t=0;t<n.length;t++)ut[n[t]]=ct(n[t])}function wt(n,t){u.shade||d.css({top:c(-t),left:c(-n)});rt.css({top:c(t),left:c(n)})}function bt(n,t){rt.width(Math.round(n)).height(Math.round(t))}function v(){var n=h.getFixed();h.setPressed([n.x,n.y]);h.setCurrent([n.x2,n.y2]);w()}function w(n){if(i)return b(n)}function b(n){var t=h.getFixed();bt(t.w,t.h);wt(t.x,t.y);u.shade&&nt.updateRaw(t);i||dt();n?u.onSelect.call(y,st(t)):u.onChange.call(y,st(t))}function s(n,t,r){(i||t)&&(u.bgFade&&!r?o.animate({opacity:n},{queue:!1,duration:u.fadeTime}):o.css("opacity",n))}function dt(){rt.show();u.shade?nt.opacity(ht):s(ht,!0);i=!0}function gt(){f();rt.hide();u.shade?nt.opacity(1):s(1);i=!1;u.onRelease.call(y)}function ni(){r&&it.show()}function k(){return r=!0,u.allowResize?(it.show(),!0):void 0}function f(){r=!1;it.hide()}function g(n){n?(kt=!0,f()):(kt=!1,k())}function ti(){g(!1);v()}var i,l=370,tt={},ut={},ft={},r=!1,e;return u.dragEdges&&n.isArray(u.createDragbars)&&at(u.createDragbars),n.isArray(u.createHandles)&&yt(u.createHandles),u.drawBorders&&n.isArray(u.createBorders)&&vt(u.createBorders),n(t).bind("touchstart.jcrop-ios",function(t){n(t.currentTarget).hasClass("jcrop-tracker")&&t.stopPropagation()}),e=ci().mousedown(oi("move")).css({cursor:"move",position:"absolute",zIndex:360}),p.support&&e.bind("touchstart.jcrop",p.createDragger("move")),pt.append(e),f(),{updateVisible:w,update:b,release:gt,refresh:v,isAwake:function(){return i},setCursor:function(n){e.css("cursor",n)},enableHandles:k,enableOnly:function(){r=!0},showHandles:ni,disableHandles:f,animMode:g,setBgOpacity:s,done:ti}}(),w=function(){function l(i){g.css({zIndex:450});i?n(t).bind("touchmove.jcrop",w).bind("touchend.jcrop",b):s&&n(t).bind("mousemove.jcrop",c).bind("mouseup.jcrop",r)}function a(){g.css({zIndex:290});n(t).unbind(".jcrop")}function c(n){return i(tt(n)),!1}function r(n){return n.preventDefault(),n.stopPropagation(),ft&&(ft=!1,e(tt(n)),f.isAwake()&&u.onSelect.call(y,st(h.getFixed())),a(),i=function(){},e=function(){}),!1}function v(n,t,r){return ft=!0,i=n,e=t,l(r),!1}function w(n){return i(tt(p.cfilter(n))),!1}function b(n){return r(p.cfilter(n))}function k(n){g.css("cursor",n)}var i=function(){},e=function(){},s=u.trackDocument;return s||g.mousemove(c).mouseup(r).mouseout(r),o.before(g),{activateHandlers:v,setCursor:k}}(),dt=function(){function e(){u.keySupport&&(t.show(),t.focus())}function s(){t.hide()}function i(n,t,i){u.allowMove&&(h.moveOffset([t,i]),f.updateVisible(!0));n.preventDefault();n.stopPropagation()}function c(n){if(n.ctrlKey||n.metaKey)return!0;vi=n.shiftKey?!0:!1;var t=vi?10:1;switch(n.keyCode){case 37:i(n,-t,0);break;case 39:i(n,t,0);break;case 38:i(n,0,-t);break;case 40:i(n,0,t);break;case 27:u.allowSelect&&f.release();break;case 9:return!0}return!1}var t=n('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),r=n("<div />").css({position:"absolute",overflow:"hidden"}).append(t);return u.keySupport&&(t.keydown(c).blur(s),ri||!u.fixedSupport?(t.css({position:"absolute",left:"-20px"}),r.append(t).insertBefore(o)):t.insertBefore(o)),{watchKeys:e}}();return p.support&&g.bind("touchstart.jcrop",p.newSelection),it.hide(),ni(!0),y={setImage:sr,animateTo:ir,setSelect:yi,setOptions:fr,tellSelect:rr,tellScaled:ur,setClass:tr,disable:wi,enable:bi,cancel:er,release:f.release,destroy:or,focus:dt.watchKeys,getBounds:function(){return[s*a,e*v]},getWidgetSize:function(){return[s,e]},getScaleFactor:function(){return[a,v]},getOptions:function(){return u},ui:{holder:b,selection:rt}},ii&&b.bind("selectstart",function(){return!1}),l.data("Jcrop",y),y};n.fn.Jcrop=function(i,r){var u;return i.document&&(t=i.document),this.each(function(){if(n(this).data("Jcrop")){if(i==="api")return n(this).data("Jcrop");n(this).data("Jcrop").setOptions(i)}else this.tagName=="IMG"?n.Jcrop.Loader(this,function(){n(this).css({display:"block",visibility:"hidden"});u=n.Jcrop(this,i);n.isFunction(r)&&r.call(u)}):(n(this).css({display:"block",visibility:"hidden"}),u=n.Jcrop(this,i),n.isFunction(r)&&r.call(u))}),this};n.Jcrop.Loader=function(t,i,r){function e(){f.complete?(u.unbind(".jcloader"),n.isFunction(i)&&i.call(f)):window.setTimeout(e,50)}var u=n(t),f=u[0];u.bind("load.jcloader",e).bind("error.jcloader",function(){u.unbind(".jcloader");n.isFunction(r)&&r.call(f)});f.complete&&n.isFunction(i)&&(u.unbind(".jcloader"),i.call(f))};n.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery)};WDSaisieAPI.prototype.GetListeFeuillesCSS=function(){var n=[],t=this.m_oDocument.head.querySelectorAll("style[data-windev]");return t.forEach(function(t){var i={origine:t.getAttribute("data-windev"),integre:!0};n.push(i)}),t=this.m_oDocument.head.querySelectorAll("link[href]"),t.forEach(function(t){var i={origine:t.getAttribute("href"),integre:!1};n.push(i)}),JSON.stringify(n)};WDSaisieAPI.prototype.SupprimeFeuillesCSS=function(n,t){var i={balise:t?"style":"link",attr:t?"data-windev":"href"},r=!1;if(this.m_oDocument.head.querySelectorAll(i.balise+"["+i.attr+"]").forEach(t=>{t.getAttribute(i.attr)===n&&(t.remove(),r=!0)}),!r){alert("CSS not found : \n<"+sSelector+">");return}this.m_sDerniereValeurHtmlAffectee=undefined};WDSaisieAPI.prototype.AjouteFeuillesCSS=function(n,t,i){var r;t?(r=this.m_oDocument.createElement("style"),r.setAttribute("data-windev",n),r.innerHTML="\n"+i+"\n"):(r=this.m_oDocument.createElement("link"),r.setAttribute("href",n),r.setAttribute("rel","stylesheet"));this.m_oDocument.head.append(r);this.m_sDerniereValeurHtmlAffectee=undefined};WDSaisieAPI.prototype.GetScrollPosY=function(){return Math.floor(this.m_oWindow.scrollY)};WDSaisieAPI.prototype.SetScrollPosY=function(n){this.m_oWindow.scroll(0,n)};WDSaisieAPI.prototype.GetMaxScrollPosY=function(){var n=Math.max(this.m_oDocument.body.scrollHeight-this.m_oDocument.body.clientHeight,this.m_oDocument.body.scrollHeight-document.documentElement.clientHeight,this.m_oWindow.scrollY);return Math.floor(n)};WDSaisieAPI.prototype.GetLargeurNecessaire=function(){return Math.floor(this.m_oDocument.body.scrollWidth)}